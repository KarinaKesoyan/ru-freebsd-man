.\"	$NetBSD: tcpdump.8,v 1.9 2003/03/31 00:18:17 perry Exp $
.\"
.\" Copyright (c) 1987, 1988, 1989, 1990, 1991, 1992, 1994, 1995, 1996, 1997
.\"	The Regents of the University of California.  All rights reserved.
.\" All rights reserved.
.\"
.\" Распространение и использование в исходном коде и двоичной форме, с изменениями или без них 
.\" допускается при условии, что: (1) распространение исходного кода
.\" сохраняет вышеуказанное уведомление об авторских правах и этот абзац в полном объеме, (2)
.\" дистрибутивы, содержащие двоичный код, содержат вышеуказанное уведомление об авторских правах и
.\" этот абзац полностью включен в документацию или другие материалы,
.\" поставляемые с дистрибутивом, и (3) все рекламные материалы, в которых упоминаются
.\" функции или использование этого программного обеспечения, свидетельствуют о следующем подтверждении:
.\" `Данный продукт включает в себя программное обеспечение, разработанное Калифорнийским университетом,
.\" Лабораторией Лоуренса Беркли и ее сотрудниками." Ни название
.\" университета, ни имена его сотрудников не могут использоваться для поддержки
.\" или продвижения продуктов, созданных на основе этого программного обеспечения, без предварительного уведомления
.\" письменное разрешение.
.\" ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ `КАК ЕСТЬ" И БЕЗ КАКИХ-ЛИБО ЯВНЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ
.\" ГАРАНТИИ, ВКЛЮЧАЯ, ПОМИМО ПРОЧЕГО, ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ
.\" ТОВАРНАЯ ПРИГОДНОСТЬ И ПРИГОДНОСТЬ ДЛЯ ОПРЕДЕЛЕННОЙ ЦЕЛИ.
.\"
.TH TCPDUMP 1  "12 March 2023"
.SH НАИМЕНОВАНИЕ
tcpdump \- dump traffic on a network
.SH КРАТКИЙ ОБЗОР
.na
.B tcpdump
[
.B \-AbdDefhHIJKlLnNOpqStuUvxX#
] [
.B \-B
.I buffer_size
]
.br
.ti +8
[
.B \-c
.I count
]
[
.B \-\-count
]
[
.B \-C
.I file_size
]
.ti +8
[
.B \-E
.I spi@ipaddr algo:secret,...
]
.ti +8
[
.B \-F
.I file
]
[
.B \-G
.I rotate_seconds
]
[
.B \-i
.I interface
]
.ti +8
[
.B \-\-immediate\-mode
]
[
.B \-j
.I tstamp_type
]
[
.B \-m
.I module
]
.ti +8
[
.B \-M
.I secret
]
[
.B \-\-number
]
[
.B \-\-print
]
[
.B \-Q
.I in|out|inout
]
.ti +8
[
.B \-r
.I file
]
[
.B \-s
.I snaplen
]
[
.B \-T
.I type
]
[
.B \-\-version
]
.ti +8
[
.B \-V
.I file
]
[
.B \-w
.I file
]
[
.B \-W
.I filecount
]
[
.B \-y
.I datalinktype
]
.ti +8
[
.B \-z
.I postrotate-command
]
[
.B \-Z
.I user
]
.ti +8
[
.BI \-\-time\-stamp\-precision= tstamp_precision
]
.ti +8
[
.BI \-\-micro
]
[
.BI \-\-nano
]
.ti +8
[
.I expression
]
.br
.ad
.SH ОПИСАНИЕ
.LP
\fITcpdump\fP выводит описание содержимого пакетов на сетевом интерфейсе, 
которое соответствует логическому значению \fIexpression\fP (смотреть
.BR \%pcap-filter (7)
для \fIexpression\fP syntax); 
описанию предшествует временная метка, которая по умолчанию отображается в виде часов,
минут, секунд и долей секунды с полуночи.  Программа также может
быть запущена с помощью
.B \-w
флаг, который заставляет его сохранять пакетные данные в файл для последующего
анализа, и/или с помощью
.B \-r
флаг, который заставляет его считывать данные из сохраненного файла пакета, а не
из сетевого интерфейса.  Его также можно запустить с помощью
.B \-V
флаг, который заставляет его считывать список сохраненных файлов пакетов. Во всех случаях
используются только пакеты, соответствующие
.I выражение
будет обработано с помощью
.IR tcpdump .
.LP
.I Tcpdump
будет, если не будет запущен с
.B \-c
флажком, продолжать захват пакетов до тех пор, пока он не будет прерван сигналом SIGINT
(генерируемым, например, путем ввода вашего символа прерывания,
обычно control-C) или сигналом SIGTERM (обычно генерируемым с помощью
.BR kill (1)
command); если запустить с помощью
.B \-c
если установлен флажок, он будет перехватывать пакеты до тех пор, пока не будет прерван сигналом SIGINT или
SIGTERM или пока не будет обработано указанное количество пакетов.
.LP
Когда
.I tcpdump
завершится захват пакетов, он сообщит о количестве:
.IP
пакеты `захвачены" (это количество пакетов, которые
.I tcpdump
были получены и обработаны);
.IP
пакеты `получены фильтром" (значение этого зависит от операционной системы, на
которой вы работаете,
.IR tcpdump ,
и, возможно, от того, как была настроена операционная система - если
в командной строке был указан фильтр, в некоторых операционных системах он подсчитывает пакеты независимо
от того, соответствовали ли они выражению фильтра, и даже если они
были сопоставлены с помощью выражения фильтра, независимо от того, были ли
.I tcpdump
если он еще не прочитал и не обработал их, то в других операционных системах он подсчитывает только те пакеты, которые были
сопоставлены с помощью выражения фильтра, независимо от того, были ли
.I tcpdump
пока не прочитал и не обработал их, а в других операционных системах учитываются только
те пакеты, которые были сопоставлены с помощью выражения фильтра и были обработаны
.IR tcpdump );
.IP
пакеты, `отброшенные ядром" (это количество пакетов, которые были
отброшены из-за нехватки места в буфере механизмом перехвата пакетов
в операционной системе, на которой
.I tcpdump
запущены, если операционная система сообщает эту информацию приложениям; в противном случае
это будет указано как 0).
.LP
На платформах, поддерживающих сигнал SIGINFO, таких как большинство BSD
(включая macOS) и Digital/Tru64 UNIX, он сообщит об этих показателях
при получении сигнала SIGINFO (генерируемого, например, путем ввода
вашего символа `status", обычно control-T, хотя на некоторых
платформах, таких как mac OS, символ `status" по
умолчанию не установлен, поэтому вы должны установить его с помощью
.BR stty (1)
чтобы использовать его) и продолжит захват пакетов. На платформах, которые
не поддерживают сигнал SIGINFO, того же можно добиться, используя сигнал
SIGUSR1.
.LP
Используя сигнал SIGUSR2 вместе с
.B \-w
флагом приведет к принудительному сбросу буфера пакетов в выходной файл.
.LP
Для чтения пакетов с сетевого интерфейса может потребоваться наличие у вас
особых привилегий; подробности смотрите на
.BR pcap (3PCAP)
странице руководства. Чтение сохраненного файла пакета не требует
специальных привилегий.
.SH ПАРАМЕТРЫ
.TP
.B \-A
Отобразить каждый пакет (за вычетом его заголовка на уровне ссылок) в формате ASCII.  Удобно для
создания веб-страниц.
.TP
.B \-b
Выводите номер AS в пакетах BGP в формате ASDOT, а не В виде обычной
записи.
.TP
.BI \-B " buffer_size"
.PD 0
.TP
.BI \-\-buffer\-size= buffer_size
.PD
Установите размер буфера захвата операционной системы равным \fI buffer_size\fP, в
килобайтах (1024 байта).
.TP
.BI \-c " count"
Выйдите после получения \fIcount\fP packets.
.TP
.BI \-\-count
Выводите количество пакетов только при стандартном выводе при чтении файлов захвата вместо
анализа/печати пакетов. Если в командной
строке указан фильтр, \fItcpdump\fP подсчитывает только те пакеты, которые были сопоставлены с
выражением фильтра.
.TP
.BI \-C " file_size"
Перед записью необработанного пакета в файл сохранения проверьте,
не превышает ли размер файла в данный момент \file_size\fP, и, если да, закрыть текущий
файл сохранения и открыть новый. Сохраняемые файлы после первого сохранения будут
иметь имя, указанное с помощью
.B \-w
флажка, с номером после него, начинающимся с 1 и продолжающимся вверх.
Единицами измерения \fIfile_size\fP являются миллионы байт (1 000 000 байт,
а не 1 048 576 байт).
.TP
.B \-d
Выведите скомпилированный код сопоставления пакетов в удобочитаемой форме в
стандартный вывод и остановитесь.
.IP
Пожалуйста, имейте в виду, что, хотя компиляция кода всегда зависит от DLT,
обычно невозможно (и не нужно) указывать, какую библиотеку DLL использовать
для дампа, потому что \fItcpdump\fP использует либо DLT входного
файла pcap, указанного с помощью
.BR -r ,
или значение разности по умолчанию для сетевого интерфейса, указанное с помощью
.BR -i ,
или конкретное значение разности для сетевого интерфейса, указанное с помощью
.B -y
И
.B -i
соответственно. В этих случаях в дампе отображается точно такой же код, который
отфильтровывал бы входной файл или сетевой интерфейс без
.BR -d .
.IP
Однако, когда ни то, ни другое
.B -r
ни
.B -i
указывается, указывая
.B -d
предотвращает \fItcpdump\fP от подбора подходящего сетевого интерфейса (смотрите
.BR -i ).
В этом случае значение DLT по умолчанию равно EN10MB и может быть установлено на другое допустимое
значение вручную с помощью
.BR -y .
.TP
.B \-dd
Дамп кода для сопоставления пакетов в виде
.B C
фрагмента программы.
.TP
.B \-ddd
Выводите соответствующий пакету код в виде десятичных чисел (перед которыми указывается число).
.TP
.B \-D
.PD 0
.TP
.B \-\-list\-interfaces
.PD
Распечатать список сетевых интерфейсов, доступных в системе и с
помощью которых
.I tcpdump
можно перехватить пакеты. Для каждого сетевого интерфейса выводятся номер и
название интерфейса, за которыми, возможно, следует текстовое описание
интерфейса. Имя интерфейса или номер могут быть предоставлены
пользователю.
.B \-i
флажком, указывающий интерфейс, на котором выполняется захват.
.IP
Это может быть полезно в системах, в которых нет команды для их перечисления
(например, в системах Windows или UNIX отсутствует
.BR "ifconfig \-a" ).;
этот номер может быть полезен в системах Windows 2000 и более поздних версиях, где имя
интерфейса представляет собой несколько сложную строку.
.IP

.B \-D
флаг не будет поддерживаться, если
.I tcpdump
он был собран с использованием более старой версии,
.I libpcap
в которой отсутствует эта
.BR pcap_findalldevs (3PCAP)
функция.
.TP
.B \-e
Вывести заголовок канального уровня в каждой строке дампа.  Это можно использовать,
например, для печати адресов MAC-уровня для таких протоколов, как Ethernet и
IEEE 802.11.
.TP
.B \-E
Использовать алгоритм \fIspi@ipaddr:secret\fP для расшифровки ESP-пакетов IPSec,
адресованных \fIaddr\fP и содержащих значение индекса параметра безопасности
\fIspi\fP. Эта комбинация может повторяться с разделением запятой или новой строкой.
.IP
Обратите внимание, что в настоящее время поддерживается установка секретности для ESP-пакетов IPv4.
.IP
Алгоритмы могут быть
\fBdes-cbc\fP,
\fB3des-cbc\fP,
\fBblowfish-cbc\fP,
\fBrc3-cbc\fP,
\fBcast128-cbc\fP, или
\fBnone\fP.
Значение по умолчанию равно \fBdes-cbc\fP.
Возможность расшифровки пакетов присутствует только в том случае, если \fItcpdump\fP был скомпилирован
с включенной криптографией.
.IP
\fIsecret\fP это ASCII-текст для секретного ключа ESP.
Если перед ним стоит 0x, то будет считано шестнадцатеричное значение.
.IP
Этот параметр предполагает использование RFC 2406, а не RFC 1827.
Этот параметр предназначен только для целей отладки, и
использование этого параметра с настоящим "секретным" ключом не рекомендуется.
Вводя секретный ключ IPSec в командную строку
, вы делаете его видимым для других пользователей с помощью
.IR ps (1)
и в других случаях.
.IP
В дополнение к приведенному выше синтаксису, для того, чтобы tcpdump прочитал предоставленный файл,
может использоваться синтаксис \fIfile name\fP. Файл открывается при получении первого ESP-пакета,
поэтому все специальные разрешения, которые
могли быть предоставлены tcpdump, уже должны были быть отменены.
.TP
.B \-f
Вывести `чужие" IPv4-адреса численно, а не символически
(этот параметр предназначен для предотвращения серьезных повреждений мозга в
NIS-сервер Sun (обычно он вечно зависает, переводя номера нелокального
Интернета).
.IP
Проверка на наличие "чужих" IPv4-адресов выполняется с использованием IPv4-адреса и
сетевой маски интерфейса, на котором выполняется перехват.  Если этот
адрес или маска сети недоступны, либо потому
, что интерфейс, в котором выполняется перехват, не имеет адреса или маски сети, либо
потому, что это псевдоинтерфейс "any", который
доступен в Linux и в последних версиях macOS и Solaris и который
может выполнять перехват более чем на одном интерфейсе, этот параметр не будет работать
корректно.
.TP
.BI \-F " файл"
Использовать \fIfile\fP в качестве входных данных для выражения фильтра.
Дополнительное выражение, заданное в командной строке, игнорируется.
.TP
.BI \-G " rotate_seconds"
Если указано, файл дампа, указанный с помощью
.B \-w
параметра, будет обновляться каждые \fIrotate_seconds\fP секунд.
Сохраняемые файлы будут иметь указанное имя,
.B \-w
которое должно включать формат времени, определенный
.BR strftime (3).
Если формат времени не указан, каждый новый файл будет перезаписывать предыдущий.
Всякий раз, когда сгенерированное имя файла не является уникальным, tcpdump перезапишет
ранее существовавшие данные; поэтому не рекомендуется указывать более точное время, чем период
записи.
.IP
При использовании в сочетании с
.B \-C
этой опцией имена файлов будут иметь форму `\fIfile\fP<количество>'.
.TP
.B \-h
.PD 0
.TP
.B \-\-help
.PD
Вывести строки версий tcpdump и libpcap, вывести сообщение об использовании
и завершить работу.
.TP
.B \-\-version
.PD
Выведите строки версий tcpdump и libpcap и завершите работу.
.TP
.B \-H
Попытка обнаружить заголовки черновой сетки стандарта 802.11s.
.TP
.BI \-i " интерфейс"
.PD 0
.TP
.BI \-\-interface= interface
.PD
Послушайте, сообщите о списке типов канального уровня
, о списке типов временных меток или о результатах компиляции выражения фильтра в
\\interface\fP. Если не указано и если флаг
.B -d
не задан, \fItcpdump\fP выполняет поиск в
списке системных интерфейсов в поисках настроенного интерфейса с наименьшим номером
(исключая loopback), который может оказаться, например, `eth0".
.IP
В системах Linux с ядрами версии 2.2 или более поздних версий, а также в последних версиях macOS
и Solaris
.
Аргумент интерфейса I, равный `any", может использоваться для перехвата пакетов со всех интерфейсов.
Обратите внимание, что захваты в псевдоинтерфейсе `any" не будут выполняться в произвольном
режиме.
.IP
Если
.B \-D
если флаг поддерживается,
то в качестве
.I интерфейс
аргумента может использоваться номер интерфейса, указанный этим флагом,
если ни один интерфейс в системе не имеет такого номера в качестве имени.
.TP
.B \-I
.PD 0
.TP
.B \-\-monitor\-mode
.PD
Switch the interface to "monitoring mode"; this is supported only on IEEE 802.11 Wi-Fi
interfaces and is supported only on some operating systems.
.IP
Обратите внимание, что в режиме мониторинга адаптер может отключиться от
сети, к которой он подключен, и вы не сможете использовать
какие-либо беспроводные сети с этим адаптером.  Это может привести к невозможности доступа
к файлам на сетевом сервере, а также к невозможности определения имен хостов или сетевых адресов,
если запись ведется в режиме мониторинга и вы не подключены к другой
сети с помощью другого адаптера.
.IP
Этот флаг повлияет на выходные данные
.B \-L
флаг.  Если
.B \-I
параметр не указан, будут показаны только те типы канального уровня, которые доступны не в
режиме мониторинга; если
.B \-I
указано, будут показаны только те типы канального уровня,
которые доступны в режиме мониторинга.
.TP
.BI \-\-immediate\-mode
Захват в "немедленном режиме".  В этом режиме пакеты доставляются в
tcpdump сразу после их поступления, а не буферизуются для
повышения эффективности.  Это значение используется по умолчанию при печати пакетов, а не
при сохранении пакетов в `файл сохранения", если пакеты выводятся на
терминал, а не в файл или канал передачи.
.TP
.BI \-j " tstamp_type"
.PD 0
.TP
.BI \-\-time\-stamp\-type= tstamp_type
.PD
Установите тип временной метки для захвата равным \Fit stamp_type\FP.  Имена
, используемые для типов временных меток, приведены в
.BR \%pcap-tstamp (7);
не все перечисленные там типы обязательно будут допустимы для любого данного
интерфейса.
.TP
.B \-J
.PD 0
.TP
.B \-\-list\-time\-stamp\-types
.PD
Перечислите поддерживаемые типы временных меток для интерфейса и завершите работу.  Если
тип временной метки не может быть задан для интерфейса, типы временных меток
в списке не отображаются.
.TP
.BI \-\-time\-stamp\-precision= tstamp_precision
При захвате установите точность временной метки для захвата
равной \\fIt stamp_precision\fP.  Обратите внимание, что наличие высокоточных временных
меток (наносекунд) и их фактическая точность зависят от платформы и аппаратного
обеспечения.  Также обратите внимание, что при записи записей, сделанных с наносекундной
точностью, в файл сохранения временные метки записываются с наносекундным
разрешением, а в файл записывается другое магическое число,
указывающее, что временные метки указаны в секундах и наносекундах; не все
программы, которые читают файл сохранения pcap, смогут прочитать эти записи.
.IP
При чтении файла сохранения преобразовываются временные метки с точностью, указанной
в параметре \timestamp_precision\fP, и отобразите их с этим разрешением.  Если
указанная точность меньше точности временных меток в
файле, преобразование приведет к потере точности.
.IP
Поддерживаемыми значениями для параметра \fI timestamp_precision\fP являются \fBmicro\fP для
разрешения в микросекунды и \fBnano\fP для разрешения в наносекунды.  По
умолчанию используется разрешение в микросекунды.
.TP
.B \-\-micro
.PD 0
.TP
.B \-\-nano
.PD
Сокращенные обозначения для \fB\-\-time\-stamp\-precision=micro\fP или
\fB\-\-time\-stamp\-precision=nano\fP,
соответственно изменяя точность отметки времени.  При чтении пакетов из файла сохранения при использовании
\\fB\-\-micro\fP временные метки сокращаются, если файл сохранения был создан с
точностью до наносекунды.  Напротив, в файле сохранения, созданном с
точностью до микросекунды, к отметке времени будут добавлены конечные нули, если используется
\fB\-\-nano\fP.
.TP
.B \-K
.PD 0
.TP
.B \-\-dont\-verify\-checksums
.PD
Не пытайтесь проверять контрольные суммы по протоколам IP, TCP или UDP.  Это полезно для
интерфейсов, которые частично или полностью выполняют вычисление этих контрольных
сумм аппаратно; в противном случае все исходящие контрольные суммы по протоколу TCP будут помечены как неверные.
.TP
.B \-l
Сделать строку стандартного вывода буферизованной.
Полезно, если вы хотите видеть данные
во время их записи.
E.g.,
.IP
.RS
.RS
.nf
\fBtcpdump \-l | tee dat\fP
.fi
.RE
.RE
.IP
or
.IP
.RS
.RS
.nf
\fBtcpdump \-l > dat & tail \-f dat\fP
.fi
.RE
.RE
.IP
Обратите внимание, что в Windows `строка с буферизацией" означает `небуферизованная", так что
WinDump запишет каждый символ отдельно, если
.B \-l
указан.
.IP
.B \-U
похож на
.B \-l
в своем поведении, но это приведет к тому, что выходные данные будут `буферизованы пакетами", так
что выходные данные записываются в стандартный вывод в конце каждого пакета, а
не в конце каждой строки; это буферизуется на всех платформах,
включая Windows.
.TP
.B \-L
.PD 0
.TP
.B \-\-list\-data\-link\-types
.PD
Перечислите известные типы каналов передачи данных для интерфейса в указанном режиме
и завершите работу.  Список известных типов каналов передачи данных может зависеть от
указанного режима; например, на некоторых платформах интерфейс Wi-Fi может
поддерживать один набор типов каналов передачи данных, когда он не находится в режиме мониторинга (
например, он может поддерживать только поддельные заголовки Ethernet или может поддерживать
Заголовки 802.11, но не поддерживают заголовки 802.11 с радиоинформацией)
и другой набор типов каналов передачи данных в режиме мониторинга (например, он
может поддерживать заголовки 802.11 или заголовки 802.11 с радиоинформацией,
только в режиме мониторинга).
.TP
.BI \-m " модуль"
Загрузка определения модулей SMI MIB из файла \fImodule\fR.
Эту опцию
можно использовать несколько раз для загрузки нескольких модулей MIB в \fItcpdump\fP.
.TP
.BI \-M " secret"
Использовать \fI secret\fP в качестве общего секрета для проверки дайджестов, найденных в
Сегменты TCP с параметром TCP-MD5 (RFC 2385), если таковой имеется.
.TP
.B \-n
Не преобразует адреса (например, адреса хостов, номера портов и т.д.) в имена.
.TP
.B \-N
Не указывает доменное имя для имен хостов.
Например,
если вы установите этот флажок, то в \fItcpdump\fP
вместо `nic.ddn.mil" будет выведено "nic".
.TP
.B \-#
.PD 0
.TP
.B \-\-number
.PD
Выведите необязательный номер пакета в начале строки.
.TP
.B \-O
.PD 0
.TP
.B \-\-no\-optimize
.PD
Не запускает оптимизатор кода для сопоставления пакетов.
Это полезно, только
если вы подозреваете ошибку в оптимизаторе.
.TP
.B \-p
.PD 0
.TP
.B \-\-no\-promiscuous\-mode
.PD
\fIDon't\fP поместить интерфейс
в неразборчивый режим.
Обратите внимание, что интерфейс может находиться в неразборчивом
режиме по какой-либо другой причине; следовательно, "-p" не может использоваться в качестве сокращения для
"ether host {local-hw-addr} или ether broadcast".
.TP
.BI \-\-print
Распечатать выходные данные проанализированного пакета, даже если необработанные пакеты сохраняются в
файл с
.B \-w
флагом.
.TP
.BI \-Q " direction"
.PD 0
.TP
.BI \-\-direction= direction
.PD
Выберать направление отправки/получения \direction\fR, для которого следует
перехватывать пакеты. Возможные значения - `входящий", `исходящий" и `около". Доступно не
на всех платформах.
.TP
.B \-q
Быстро (тихо?) выход.
Печатать меньше информации о протоколе, чтобы выходные
строки были короче.
.TP
.BI \-r " file"
Считывает пакеты из \Fifile\FR (который был создан с помощью опции
.B \-w
или другими инструментами, которые записывают файлы pcap или pcapng).
Используется стандартный ввод, если \Fifile\FR равен `-".
.TP
.B \-S
.PD 0
.TP
.B \-\-absolute\-tcp\-sequence\-numbers
.PD
Вывести абсолютные, а не относительные порядковые номера TCP.
.TP
.BI \-s " snaplen"
.PD 0
.TP
.BI \-\-snapshot\-length= snaplen
.PD
Snarf \fIsnaplen\Количество байт данных из каждого пакета вместо
262144 байт по умолчанию.
Пакеты, усеченные из-за ограниченного времени создания моментального
снимка, отображаются в выходных данных как `[|\fI proto\fP]", где \fI proto\fP
- это название уровня протокола, на котором произошло усечение.
.IP
Обратите внимание, что создание снимков большего
размера увеличивает время, необходимое для обработки пакетов, и, по сути,
уменьшает объем буферизации пакетов.
Это может привести к
потере пакетов.
Обратите также внимание, что при создании снимков меньшего размера данные из протоколов
, расположенных выше транспортного уровня, будут удалены, что приведет к потере
важной информации.  Например, запросы и ответы NFS и AFS очень
велики, и большая часть деталей будет недоступна, если выбрана слишком короткая
длина снимка.
.IP
Если вам нужно уменьшить размер моментального снимка ниже значения по умолчанию, вам следует
ограничить \fIsnaplen\fP наименьшим числом, которое позволит получить
интересующую вас информацию о протоколе.  Установка
\fIsnaplen\fP в 0 устанавливает значение по умолчанию 262144
для обратной совместимости с последними старыми версиями
.ИК-tcpdump .
.TP
.BI \-T " type"
Принудительно интерпретировать пакеты, выбранные с помощью "\fIexpression\fP"
, в соответствии с указанным \fItype\fR.
В настоящее время известны следующие типы
: \fBaodv\fR (специальный протокол векторного расстояния по требованию),
\fBcarp\fR (Протокол резервирования общих адресов),
\fBcnfp\fR (протокол Cisco NetFlow),
\\domain\fR (Система доменных имен),
\\fblp\fR (Управление каналами Протокол),
\\fbm\fR (Прагматичная общая многоадресная рассылка),
\\fBpgm_zmtp1\fR (SMTP/1.0 внутри PGM/EPGM),
\fBptp\fR (Протокол точного времени),
\\fB radius\fR (РАДИУС),
\fBresp\fR (протокол сериализации REdis),
\fBrpc\fR (Удаленный вызов процедуры),
\\fbtcp\fR (Протокол управления приложениями реального времени),
\fBrtp\fR (протокол приложений реального времени),
\\dbsnmp\fR (Простой протокол сетевого управления),
\\fBsomeip\fR (SOME/IP),
\\FBTTP\fR (Обычный протокол передачи файлов),
\\fBvat\fR (Визуальный аудиоинструмент),
\fBvxlan\fR (Виртуальная расширяемая локальная сеть),
\\fbwb\fR (распределенная доска объявлений)
и
\\fBzmtp1\fR (протокол передачи сообщений ZeroMQ версии 1.0).
.IP
Обратите внимание, что указанный выше тип \fbm\fR влияет только на интерпретацию UDP, а не на собственный
PGM всегда распознается как IP-протокол 113 независимо от этого. PGM, инкапсулированный в UDP
, часто называют "EPGM" или "PGM/UDP".
.IP
Обратите внимание, что приведенный выше тип \fBpgm_zmtp1\fR влияет на интерпретацию обоих собственных
PGM и UDP одновременно. Во время собственного PGM-декодирования прикладных данных
Пакет ODATA/RDATA будет декодирован как дейтаграмма ZeroMQ с фреймами SMTP/1.0.
В дополнение к этому, во время декодирования UDP любой пакет UDP будет рассматриваться как
инкапсулированный пакет PGM.
.TP
.B \-t
\fIDon't\fP вывести временную метку в каждой строке дампа.
.TP
.B \-tt
Напечатать метку времени, в секундах с 1 января 1970, , 00:00:00, мирового и
доли секунды с того времени в каждой строке дампа.
.TP
.B \-ttt
Вывести разность (с разрешением в микросекунды или наносекунды, в зависимости от параметра
.B \-\-time\-stamp-precision
) между текущей и предыдущей строками в каждой строке дампа.
По умолчанию используется разрешение в микросекунды.
.TP
.B \-tttt
Выведите временную метку в виде часов, минут, секунд и долей секунды
, прошедших с полуночи, с указанием даты в каждой строке дампа.
.TP
.B \-ttttt
Вывести разность (с разрешением в микросекунды или наносекунды, в зависимости от параметра
.B \-\-time\-stamp-precision
) между текущей и первой строками в каждой строке дампа.
По умолчанию используется разрешение в микросекунды.
.TP
.B \-u
Вывести недекодированные дескрипторы NFS.
.TP
.B \-U
.PD 0
.TP
.B \-\-packet\-buffered
.PD
Если
.B \-w
параметр не указан, или, если он указан, но
также указан флаг .B \-\-print,
выполните вывод распечатанного пакета
`с буферизацией пакетов"; то есть, когда описание содержимого каждого
пакета выводится на печать, оно будет записываться в стандартный выходной
файл, вместо того, чтобы, когда запись не выполняется в терминал, записываться только при заполнении выходного
буфера.
.IP
Если
.B \-w
если указана опция, выводите сохраненный необработанный пакет
`с буферизацией пакетов", т.е. по мере сохранения каждого пакета он будет записываться
в выходной файл, а не только при заполнении выходного
буфера.
.IP

.B \-U
флаг не будет поддерживаться, если
.I tcpdump
был собран с использованием более старой версии
.I libpcap
, в которой отсутствует
.BR pcap_dump_flush (3PCAP)
функция.
.TP
.B \-v
При синтаксическом анализе и печати выводите (чуть более) подробные данные.
Например, печатаются время жизни,
идентификация, общая продолжительность и параметры в IP-пакете.
Также позволяет выполнять дополнительные проверки целостности пакетов, такие как проверка
Контрольная сумма заголовка IP и ICMP.
.IP
При записи в файл с помощью
.B \-w
возможность и в то же время отсутствие чтения из файла с
.B \-r
опция, сообщающая в stderr раз в секунду о количестве перехваченных пакетов. В
Solaris, FreeBSD и, возможно, в других операционных системах это периодическое обновление
в настоящее время может привести к потере перехваченных пакетов на пути из ядра в
tcpdump.
.TP
.B \-vv
Еще более подробный вывод.
Например,
в ответных пакетах NFS печатаются дополнительные поля, а SMB-пакеты полностью декодируются.
.TP
.B \-vvv
Еще более подробный вывод.
Например,
telnet \fBSB\fP ... Параметры \fbs\fP
выводятся полностью.
С
.B \-X
Параметры Telnet также выводятся в шестнадцатеричном формате.
.TP
.BI \-V " file"
Считатся список имен файлов из файла \fIfile\fR. Используется стандартный ввод
, если в файле \fIfile\fR указано `-".
.TP
.BI \-w " file"
Записывает необработанные пакеты в \fIfile\fR, а не анализирует и выводит
их.
Позже их можно распечатать с помощью опции \-r.
Если в \fIfile\fR значение `-", используется стандартный вывод.
.IP
Эти выходные данные будут буферизованы, если они будут записаны в файл или канал, поэтому программа
, считывающая пакеты из файла или канала, может не видеть пакеты в течение произвольного
периода времени после их получения.  Используется
.B \-U
флажок, позволяющий записывать пакеты сразу после их получения.
.IP
MIME-тип \fI application/vnd.tcpdump.pcap\fP был зарегистрирован
в IANA для файлов \fIpcap\fP. Расширение имени файла \fI.pcap\fP
по-видимому, наиболее часто используется наряду с \fI.cap\fP и
\fI.dmp\fP. \fITcpdump\fP сами по себе не проверяют расширение при
чтении файлов capture и не добавляют расширение при их записи
(вместо этого они используют магические цифры в заголовке файла). Однако многие
операционные системы и приложения будут использовать это расширение, если оно
присутствует, и рекомендуется добавить его (например, .pcap).
.IP
Смотрите
.BR \%pcap-savefile (5)
для получения описания формата файла.
.TP
.BI \-W " filecount"
При использовании в сочетании с параметром
.B \-C
это ограничит количество
создаваемых файлов указанным числом и начнет перезапись файлов
с самого начала, создавая, таким образом, "вращающийся" буфер.
Кроме того, он будет присваивать
файлам имена с достаточным количеством нулей в начале, чтобы поддерживать максимальное количество
файлов, что позволит правильно их сортировать.
.IP
При использовании в сочетании с параметром
.B \-G
это ограничит количество создаваемых сменяемых файлов дампа, которые будут
завершаться со статусом 0 при достижении предела.
.IP
Если используется в сочетании с обоими параметрами
.B \-C
и
.B \-G,

.B \-W
в настоящее время этот параметр игнорируется и влияет только на имя файла.
.TP
.B \-x
При разборе и печати,
в дополнение к печати заголовков каждого пакета, выводятся данные
каждого пакета (за вычетом его заголовка на уровне канала) в шестнадцатеричном формате.
Чем меньше размер всего пакета или
.I snaplen
будут напечатаны байты.  Обратите внимание, что это весь
пакет канального уровня, поэтому для канальных уровней, которые дополняют друг друга (например, Ethernet), байты заполнения
также будут напечатаны, если пакет более высокого уровня короче
требуемого размера заполнения.
В текущей реализации этот флаг может иметь тот же эффект, что и
.B \-xx
если пакет усечен.
.TP
.B \-xx
При синтаксическом анализе и печати,
в дополнение к печати заголовков каждого пакета, выводятся данные
каждого пакета,
.I включая
его заголовок канального уровня, в шестнадцатеричном формате.
.TP
.B \-X
При анализе и печати,
в дополнение к печати заголовков каждого пакета, выводятся данные
каждого пакета (за вычетом заголовка на уровне канала) в шестнадцатеричном и ASCII формате.
Это очень удобно для анализа новых протоколов.
В текущей реализации этот флаг может иметь тот же эффект, что и 
.B\-XX
если пакет усечен.
.TP
.B \-XX
При синтаксическом анализе и печати,
в дополнение к печати заголовков каждого пакета, выводятся данные
каждого пакета,
.I включая
его заголовок канального уровня, в формате hex и ASCII.
.TP
.BI \-y " datalinktype"
.PD 0
.TP
.BI \-\-linktype= datalinktype
.PD
Установить тип канала передачи данных, который будет использоваться при захвате пакетов (см.
.BR -L )
или просто скомпилировать и сбросить код для сопоставления пакетов (см.
.BR -d )
в \fIdatalinktype\fP.
.TP
.BI \-z " postrotate-command"
Используется в сочетании с
.B -C
или
.B -G
параметры, это сделает
.I tcpdump
запустить "
.I postrotate-command файл
" где
.I файл
файл сохранения закрывающийся после каждого поворота. Например, указав
.B \-z gzip
или
.B \-z bzip2
будет сжимать каждый сохраненный файл с помощью gzip или bzip2.
.IP
Обратите внимание, что tcpdump запустит команду параллельно с записью, используя
самый низкий приоритет, чтобы это не помешало процессу записи.
.IP
И в случае, если вы хотите использовать команду, которая сама принимает флаги или
другие аргументы, вы всегда можете написать сценарий оболочки, который будет принимать
имя файла сохранения в качестве единственного аргумента, распределять флаги и аргументы
и выполнять нужную вам команду.
.TP
.BI \-Z " user"
.PD 0
.TP
.BI \-\-relinquish\-privileges= user
.PD
Если
.I tcpdump
запускается от имени пользователя root, после открытия устройства захвата или входного файла сохранения,
но перед открытием любых файлов сохранения для вывода измените идентификатор пользователя на
.I user
и идентификатор группы для основной группы
.IR user .
.IP
Это поведение также может быть включено по умолчанию во время компиляции.
.IP "\fI expression\fP"
.RS
выбирает, какие пакеты будут сбрасываться.
Если значение \fIexpression\fP
не указано, будут сбрасываться все пакеты в сети.
В противном случае
будут сбрасываться только пакеты, для которых значение \fIexpression\fP равно true.
.LP
Синтаксис \fIexpression\fP смотрите в разделе
.BR \%pcap-фильтр (7).
.LP
Аргумент \fIexpression\fP может быть передан в \fItcpdump\fP либо как один аргумент оболочки,
либо как несколько аргументов оболочки, в зависимости от того, что удобнее.
Как правило, если выражение содержит метасимволы оболочки, такие как
обратная косая черта, используемая для экранирования имен протоколов, проще передать его как
один аргумент, заключенный в кавычки, чем экранировать 
метасимволы оболочки.
Перед анализом несколько аргументов объединяются пробелами.
.SH ПРИМЕРЫ
.LP
Чтобы распечатать все пакеты, прибывающие в аэропорт или отправляющиеся из \fIsundown\fP:
.RS
.nf
\fBtcpdump host sundown\fP
.fi
.RE
.LP
Для печати трафика между \fIhelios\fR and either \fIhot\fR or \fIace\fR:
.RS
.nf
\fBtcpdump принимающий гелиос и \\( hot or ace \\)\fP
.fi
.RE
.LP
Для печати всех IP-пакетов между \fIace\fR и любой хост, кроме \fIhelios\fR:
.RS
.nf
\fBtcpdump ip host ace and not helios\fP
.fi
.RE
.LP
Чтобы распечатать весь трафик между локальными хостами и хостами в Беркли:
.RS
.nf
.B
tcpdump net ucb-ether
.fi
.RE
.LP
Для печати всего ftp-трафика через internet gateway \fIsnup\fP:
(обратите внимание, что выражение заключено в кавычки, чтобы оболочка
не могла (неправильно) интерпретировать круглые скобки):
.RS
.nf
.B
tcpdump 'gateway snup and (port ftp or ftp-data)'
.fi
.RE
.LP
Для печати трафика, который не поступает с локальных хостов и не предназначен для них
((если ваш шлюз подключен к другой сети, этот материал никогда не должен попадать
в вашу локальную сеть).
.RS
.nf
.B
tcpdump ip and not net \fIlocalnet\fP
.fi
.RE
.LP
Для печати начального и конечного пакетов (SYN- и FIN-пакетов) каждого
TCP-диалог, в котором задействован нелокальный хост.
.RS
.nf
.B
tcpdump 'tcp[tcpflags] & (tcp-syn|tcp-fin) != 0 and not src and dst net \fIlocalnet\fP'
.fi
.RE
.LP
Чтобы напечатать TCP-пакеты с установленными флагами RST и ACK.
(т.е. выберите только флаги RST и ACK в поле flags, и если результат
"RST и ACK оба установлены", выполните сопоставление)
.RS
.nf
.B
tcpdump 'tcp[tcpflags] & (tcp-rst|tcp-ack) == (tcp-rst|tcp-ack)'
.fi
.RE
.LP
Для печати всех HTTP-пакетов IPv4, поступающих на порт 80 и исходящих из него, т.е. для печати только
пакетов, содержащих данные, а не, например, пакетов SYN и FIN и
пакетов только для подтверждения.  (IPv6 оставлен в качестве упражнения для читателя.)
.RS
.nf
.B
tcpdump 'tcp port 80 and (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)'
.fi
.RE
.LP
Для печати IP-пакетов длиной более 576 байт, отправленных через шлюз \fIsnup\fP:
.RS
.nf
.B
tcpdump 'gateway snup and ip[2:2] > 576'
.fi
.RE
.LP
Для печати широковещательных или многоадресных IP-пакетов, которые были
.I не
передается по широковещательной или многоадресной рассылке Ethernet:
.RS
.nf
.B
tcpdump 'ether[0] & 1 = 0 and ip[16] >= 224'
.fi
.RE
.LP
Для печати всех ICMP-пакетов, которые не являются эхо-запросами/ответами (т.е. не
пинговыми пакетами):
.RS
.nf
.B
tcpdump 'icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply'
.fi
.RE
.SH ВЫХОДНОЙ ФОРМАТ
.LP
Выходные данные \fItcpdump\fP зависят от протокола.
Ниже
приведены краткое описание и примеры большинства форматов.
.de HD
.sp 1.5
.B
..
.HD
Временные метки
.LP
По умолчанию всем строкам вывода предшествует временная метка.
Временная метка
это текущее тактовое время в форме
.RS
.nf
\fIhh:mm:ss.frac\fP
.fi
.RE
Временная метка отражает время, в течение
которого ядро применяло временную метку к пакету.
Не предпринимается никаких попыток учесть временную задержку между моментом, когда сетевой
интерфейс завершил прием пакета из сети, и моментом, когда
ядро применило временную метку к пакету; эта временная задержка может включать
задержку между моментом, когда сетевой интерфейс завершил прием
пакета из сети, и моментом, когда произошло прерывание. был передан
ядру, чтобы заставить его прочитать пакет, и задержка между моментом,
когда ядро обработало прерывание "новый пакет", и моментом, когда оно
применил временную метку к пакету.
.HD
Заголовки на уровне ссылок
.LP
Если задан параметр "-e", выводится заголовок канального уровня.
В Ethernet-сетях выводятся адреса источника и назначения, протокол
и длина пакета.
.LP
В сетях FDDI параметр "-e" приводит к тому, что \fItcpdump\fP выводит
поле "управление кадром", адреса источника и назначения,
а также длину пакета.
(Поле "управление кадром" определяет
интерпретацию остальной части пакета.
Обычные пакеты (
например, содержащие IP-дейтаграммы) являются "асинхронными" пакетами со
значением приоритета от 0 до 7; например, "\fBasync4\fR".
Предполагается, что такие пакеты
содержат пакет управления логическим соединением стандарта 802.2 (LLC);
заголовок LLC печатается, если это не дейтаграмма ISO или
так называемый SNAP pocket.
.LP
В сетях Token Ring параметр "-e" приводит к тому, что \fItcpdump\fP выводит
поля "управление доступом" и "управление кадрами", адреса источника и
назначения, а также длину пакета.
Как и в сетях FDDI,
предполагается, что пакеты содержат пакет LLC.
Независимо от того, указана ли
опция "-e" или нет, информация
о маршруте источника выводится для пакетов, маршрутизируемых источником.
.LP
В сетях стандарта 802.11 параметр "-e" приводит к тому, что \fItcpdump\fP выводит
поля "управление кадром", все адреса в заголовке стандарта 802.11
и длину пакета.
Как и в сетях FDDI,
предполагается, что пакеты содержат пакет LLC.
.LP
\fI(N.B.: Следующее описание предполагает знакомство с
алгоритмом сжатия SLIP, описанным в RFC 1144.)\fP
.LP
На линиях связи SLIP выводится индикатор направления (`I" для входящих, `O" для исходящих),
тип пакета и информация о сжатии.
Сначала выводится тип пакета.
Существует три типа пакетов: \fIip\fP, \fIutcp\fP и \fIctcp\fP.
Для пакетов \fIip\fR дополнительная информация о соединении не выводится.
Для пакетов TCP идентификатор соединения выводится в соответствии с типом.
Если пакет сжат, то выводится его закодированный заголовок.
Особые случаи выводятся в виде
\fB*S+\fIn\fR и \fB*SA+\fIn\fR, где \fIn\fR - это величина, на которую
изменился порядковый номер (или порядковый номер и ack).
Если это не особый случай,
выводится ноль или более изменений.
Изменение обозначается U (срочный указатель), W (окно), A (подтверждение).,
S (порядковый номер) и I (идентификатор пакета), за которыми следует дельта (+n или -n)
или новое значение (=n).
Наконец, выводятся объем данных в пакете и
сжатая длина заголовка.
.LP
Например, в следующей строке показан исходящий сжатый TCP-пакет
с неявным идентификатором соединения; ack изменился на 6,
порядковый номер - на 49, а идентификатор пакета - на 6; имеется 3 байта
данных и 6 байт сжатого заголовка:
.RS
.nf
\fBO ctcp * A+6 S+49 I+6 3 (6)\fP
.fi
.RE
.HD
ARP/RARP Packets
.LP
ARP/RARP выходные данные показывают тип запроса и его аргументы.

формат должен быть понятен сам по себе.
Вот краткий пример, взятый из начала "rlogin" с
хоста \first\fP на хост \fIc sam\fP:
.RS
.nf
.sp .5
\f(CWarp who-has csam tell rtsg
arp reply csam is-at CSAM\fR
.sp .5
.fi
.RE
В первой строке говорится, что rtsg отправил ARP-пакет с запросом
Ethernet-адреса интернет-узла csam.
Csam
отвечает своим Ethernet-адресом (в этом примере
адреса Ethernet указаны заглавными буквами, а адреса Интернета - строчными).
.LP
Это выглядело бы менее избыточным, если бы мы сделали \fItcpdump \-n\fP:
.RS
.nf
.sp .5
\f(CWarp who-has 128.3.254.6 tell 128.3.254.68
arp reply 128.3.254.6 is-at 02:07:01:00:01:c4\fP
.fi
.RE
.LP
Если бы мы использовали \fItcpdump \-e\fP, то был бы виден тот факт, что первый пакет передается
широковещательно, а второй - от точки к точке:
.RS
.nf
.sp .5
\f(CWRTSG Broadcast 0806  64: arp who-has csam tell rtsg
CSAM RTSG 0806  64: arp reply csam is-at CSAM\fR
.sp .5
.fi
.RE
Для первого пакета это означает, что адрес источника Ethernet - RTSG, адрес
назначения - широковещательный адрес Ethernet, поле type
содержало шестнадцатеричный код 0806 (тип ETHER_ARP), а общая длина составляла 64 байта.
.HD
IPv4 Packets
.LP
Если заголовок канального уровня не печатается, то для пакетов IPv4,
\fBIP\fP is printed after the time stamp.
.LP
Если
.B \-v
если указан флаг, информация из заголовка IPv4 отображается в
круглых скобках после заголовка \bp\fP или заголовка канального уровня.
Общий формат этой информации следующий:
.RS
.nf
.sp .5
tos \fItos\fP, ttl \fIttl\fP, id \fIid\fP, смещение \fIoffset\fP, флажки [\fIflags\fP], прототип \fIproto\fP, длина \fIlength\fP, зараметры (\fIoptions\fP)
.sp .5
.fi
.RE
\fItos\fP это поле типа услуги; если биты ECN отличны от нуля,
они отображаются как \fBECT(1)\fP, \fBECT(0)\fP, или \fBCE\fP.
\fIttl\fP это время жизни; о нем не сообщается, если оно равно нулю.
\fIid\fP это поле для идентификации IP-адреса.
\fIoffset\fP это поле смещения фрагмента; оно выводится независимо от того, является ли это
частью фрагментированной дейтаграммы или нет.
\fIflags\fP являются флагами MF и DF; \fB+\fP сообщается, если установлен MF,
и \fBDF\fP сообщается, если задан параметр F.  Если не задан ни один из них, \fB.\fP 
сообщена.
\fIproto\fP это поле идентификатора протокола.
\fIlength\fP это поле общей длины.
\fIoptions\fP это параметры IP, если таковые имеются.
.LP
Далее, для пакетов TCP и UDP
будут напечатаны IP-адреса источника и назначения, а также порты TCP или UDP, с точкой между каждым IP-адресом и
соответствующим ему портом, при этом источник и пункт назначения будут разделены символом >.
Для других протоколов адреса будут напечатаны,
разделяя источник и пункт назначения символом >.  
После этого будет напечатана информация о протоколе более высокого уровня, если таковая имеется.
.LP
Для фрагментированных IP-дейтаграмм первый фрагмент содержит заголовок протокола более высокого
уровня; фрагменты, следующие за первым, не содержат
заголовка протокола более высокого уровня.  Информация о фрагментации будет выводиться только с
флагом
.B \-v
в информации заголовка IP, как описано выше.
.HD
TCP Пакеты
.LP
\fI(N.B.:Следующее описание предполагает знакомство с
протоколом TCP, описанным в RFC 793.
Если вы не знакомы
с протоколом, это описание будет вам не
очень полезно.)\fP
.LP
Общий формат строки протокола TCP таков:
.RS
.nf
.sp .5
\fIsrc\fP > \fIdst\fP: Flags [\fItcpflags\fP], seq \fIdata-seqno\fP, ack \fIackno\fP, win \fIwindow\fP, urg \fIurgent\fP, options [\fIopts\fP], length \fIlen\fP
.sp .5
.fi
.RE
\fISrc\fP and \fIdst\fP это IP
-адреса и порты источника и назначения.
\fITcpflags\fP aпредставляют собой некоторую комбинацию S (SYN),
F (FIN), P (PSH), R (RST), U (URG), W (CWR), E (ECE) or
`.' (ACK), или `ни один' если флаги не установлены.
\fIData-seqno\fP описывает часть пространства последовательностей, занимаемую
данными в этом пакете (см. пример ниже).
\fIAckno\fP это порядковый номер следующих данных, ожидаемых в другом
направлении по этому соединению.
\fIWindow\fP это количество байт места в буфере приема, доступного
в другом направлении по этому соединению.
\fIUrg\fP указывает на наличие в пакете `срочных" данных.
\fIOpts\fP являются TCP параметрами (e.g., mss 1024).
\fILen\fP это длина данных полезной нагрузки.
.LP
\fIIptype\fR, \fISrc\fP, \fIdst\fP, and \fIflags\fP are always present.
Остальные поля
зависят от содержимого заголовка протокола TCP пакета и
выводятся только при необходимости.
.LP
Вот начальная часть rlogin от host \fIrtsg\fP до
host \fIcsam\fP.
.RS
.nf
.sp .5
\f(CWIP rtsg.1023 > csam.login: Flags [S], seq 768512:768512, win 4096, opts [mss 1024]
IP csam.login > rtsg.1023: Flags [S.], seq, 947648:947648, ack 768513, win 4096, opts [mss 1024]
IP rtsg.1023 > csam.login: Flags [.], ack 1, win 4096
IP rtsg.1023 > csam.login: Flags [P.], seq 1:2, ack 1, win 4096, length 1
IP csam.login > rtsg.1023: Flags [.], ack 2, win 4096
IP rtsg.1023 > csam.login: Flags [P.], seq 2:21, ack 1, win 4096, length 19
IP csam.login > rtsg.1023: Flags [P.], seq 1:2, ack 21, win 4077, length 1
IP csam.login > rtsg.1023: Flags [P.], seq 2:3, ack 21, win 4077, urg 1, length 1
IP csam.login > rtsg.1023: Flags [P.], seq 3:4, ack 21, win 4077, urg 1, length 1\fR
.sp .5
.fi
.RE
В первой строке говорится, что TCP-порт 1023 на rtsg отправил пакет
на порт \fIlogin\fP
на csam.
 \fBS\fP indicates that the \fISYN\fP флажок установлен.
Порядковый номер пакета был 768512 и в нем не было никаких данных.
(Обозначение - "первый:последний", что означает "порядковые
номера". \fIfirst\fP
вплоть до, но не включая \fIlast\fP'.)
Подтверждения с поддержкой piggy-backed не было, доступное окно получения составляло 4096
байт, и была опция максимального размера сегмента, запрашивающая MSS
в 1024 байта.
.LP
Csam отвечает аналогичным пакетом, за исключением того, что он включает в себя объединенный
Подтверждение для SYN rtsg.
Rtsg затем ACKs csam's SYN.
`." означает, что был установлен флаг подтверждения.
Пакет не содержал данных, поэтому нет ни порядкового номера, ни длины данных.
Обратите внимание, что порядковый
номер подтверждения - это небольшое целое число (1).
В первый раз, когда \fItcpdump\fP увидит
TCP `диалог", он выводит порядковый номер из пакета.
В последующих пакетах обмена данными выводится разница между
порядковым номером текущего пакета и этим исходным порядковым 
номером.
Это означает, что порядковые номера после
первого могут интерпретироваться
как относительные позиции байтов в потоке данных диалога (при
этом первый байт данных в каждом направлении равен `1").
`-S' переопределит эту
функцию, в результате чего будут выведены исходные порядковые номера.
.LP
В 6-й строке rtsg отправляет csam 19 байт данных (байты со 2 по 20
в первой части диалога \(-> csam).
В пакете установлен флаг PSH.
В 7-й строке csam сообщает, что получены данные, отправленные rtsg, вплоть до
21-го байта, но не включая его.
Большая часть этих данных, по-видимому, находится в буфере
сокета, поскольку окно приема sam уменьшилось на 19 байт.
В этом пакете Sam также отправляет один байт данных в rtsg.
В 8-й и 9-й строках
csm отправляет два байта срочных данных в rtsg.
.LP
Если снимок был достаточно маленьким, чтобы \fItcpdump\fP не смог захватить
полный заголовок TCP, он интерпретирует как можно большую часть заголовка,
а затем сообщает `[|\fIt cp\fP]", указывая, что остальная часть не может
быть интерпретирована.
Если заголовок содержит фиктивный параметр (длина
которого либо слишком мала, либо находится за пределами конца заголовка), \fItcpdump\fP
сообщает об этом как о `[\fIbad opt\fP]" и не интерпретирует другие
параметры (поскольку невозможно определить, где они начинаются).
Если длина заголовка
указывает на наличие параметров, но длина IP-дейтаграммы
недостаточна для того, чтобы параметры действительно были там, \fItcpdump\fP сообщает
об этом как `[\fI bad hdr length\fP''.
.HD
.B Захват TCP-пакетов с определенными комбинациями флагов (SYN-ACK, URG-ACK, etc.)
.PP
В разделе "Управляющие биты" заголовка TCP содержится 8 битов:
.IP
.I CWR | ECE | URG | ACK | PSH | RST | SYN | FIN
.PP
Давайте предположим, что мы хотим просмотреть пакеты, используемые при установлении
TCP-соединения.
Напомним, что TCP использует трехсторонний протокол подтверждения
связи при инициализации нового соединения; последовательность соединений в
отношении управляющих битов TCP такова
.PP
.RS
1) Запросчик отправляет SYN
.RE
.RS
2) Получатель отвечает следующим образом SYN, ACK
.RE
.RS
3) Запросчик отправляет ACK
.RE
.PP
Теперь нас интересует захват пакетов, для которых установлен только
бит SYN (шаг 1).
Обратите внимание, что нам не нужны пакеты с шага 2
(SYN-ACK), только обычный начальный SYN.
Что нам нужно, так это правильное
выражение фильтра для \fitcpdump\FP.
.PP
Напомним структуру заголовка TCP без опций:
.PP
.nf
 0                            15                              31
-----------------------------------------------------------------
|          source port          |       destination port        |
-----------------------------------------------------------------
|                        sequence number                        |
-----------------------------------------------------------------
|                     acknowledgment number                     |
-----------------------------------------------------------------
|  HL   | rsvd  |C|E|U|A|P|R|S|F|        window size            |
-----------------------------------------------------------------
|         TCP checksum          |       urgent pointer          |
-----------------------------------------------------------------
.fi
.PP
The TCP header usually contains 20 octets of data, unless there are additional
options.
The first line of the graph contains octets from 0 to 3,
the second line contains octets from 4 to 7, etc.
.PP
Starting from 0, the corresponding TCP control bits are contained
in octet 13:
.PP
.nf
 0             7|             15|             23|             31
----------------|---------------|---------------|----------------
|  HL   | rsvd  |C|E|U|A|P|R|S|F|        window size            |
----------------|---------------|---------------|----------------
|               |  13th octet   |               |               |
.fi
.PP
Давайте поближе познакомимся с октетом № 13:
.PP
.nf
                |               |
                |---------------|
                |C|E|U|A|P|R|S|F|
                |---------------|
                |7   5   3     0|
.fi
.PP
Это управляющие биты TCP,
которые нас интересуют.
Мы пронумеровали биты в этом октете от 0 до 7 справа
налево, поэтому бит PSH имеет номер 3, а бит URG - номер 5.
.PP
Напомним, что мы хотим перехватывать пакеты только с установленным SYN.
Давайте посмотрим, что произойдет с октетом 13, если дейтаграмма TCP поступит
с установленным битом SYN в заголовке:
.PP
.nf
                |C|E|U|A|P|R|S|F|
                |---------------|
                |0 0 0 0 0 0 1 0|
                |---------------|
                |7 6 5 4 3 2 1 0|
.fi
.PP
Заглянув в
раздел "Управляющие биты", мы видим, что установлен только бит с номером 1 (SYN).
.PP
Предполагая, что октет с номером 13 представляет собой 8-разрядное целое число без знака в
сетевом порядке байтов, двоичное значение этого октета равно
.IP
00000010
.PP
и его десятичное представление равно
.PP
.nf
   7     6     5     4     3     2     1     0
0*2 + 0*2 + 0*2 + 0*2 + 0*2 + 0*2 + 1*2 + 0*2  =  2
.fi
.PP
Мы почти закончили, потому что теперь мы знаем, что если задан только SYN,
то значение 13-го октета в заголовке TCP, интерпретируемое
как 8-разрядное целое число без знака в сетевом порядке байтов, должно быть ровно 2.
.PP
Эта взаимосвязь может быть выражена следующим образом
.RS
.B
tcp[13] == 2
.RE
.PP
Мы можем использовать это выражение в качестве фильтра для \fItcpdump\fP,
чтобы отслеживать пакеты, для которых установлен только SYN:
.RS
.B
tcpdump -i xl0 tcp[13] == 2
.RE
.PP
Выражение гласит: "пусть 13-й октет TCP-дейтаграммы имеет
десятичное значение 2", что является именно тем, что нам нужно.
.PP
Теперь давайте предположим, что нам нужно перехватывать SYN-пакеты, но нас
не волнует, установлен ли при этом ACK или любой другой управляющий 
бит TCP.
Давайте посмотрим, что происходит с октетом 13, когда поступает TCP-дейтаграмма
с установленным SYN-ACK:
.PP
.nf
     |C|E|U|A|P|R|S|F|
     |---------------|
     |0 0 0 1 0 0 1 0|
     |---------------|
     |7 6 5 4 3 2 1 0|
.fi
.PP
Теперь биты 1 и 4 установлены в 13-м октете.
Двоичное значение
октета 13 равно
.IP
     00010010
.PP
который переводится в десятичный формат
.PP
.nf
   7     6     5     4     3     2     1     0
0*2 + 0*2 + 0*2 + 1*2 + 0*2 + 0*2 + 1*2 + 0*2   = 18
.fi
.PP
Теперь мы не можем просто использовать 'tcp[13] == 18' в выражении фильтра \fitcpdump\FP,
потому что это выбрало бы только те пакеты, у которых установлен
SYN-ACK, но не те, у которых установлен только SYN.
Помните, что нам все равно,
установлен ли ACK или любой другой управляющий бит, пока установлен SYN.
.PP
Чтобы достичь нашей цели, нам нужно логически
объединить двоичное значение октета 13 с каким-либо другим значением, чтобы сохранить
бит SYN.
Мы знаем, что хотим, чтобы SYN был установлен в любом случае,
поэтому логически сопоставим значение в 13-м октете с
двоичным значением SYN:
.PP
.nf

          00010010 SYN-ACK              00000010 SYN
     AND  00000010 (we want SYN)   AND  00000010 (we want SYN)
          --------                      --------
     =    00000010                 =    00000010
.fi
.PP
Мы видим, что эта операция И дает один и тот же результат
независимо от того, установлен ли ACK или другой управляющий бит TCP.
Десятичное представление значения AND, а также
результат этой операции равны 2 (двоичный код 00000010),
поэтому мы знаем, что для пакетов с установленным значением SYN
должно выполняться следующее соотношение:
.IP
( ( value of octet 13 ) AND ( 2 ) ) == ( 2 )
.PP
Это указывает нам на выражение фильтра \fItcpdump\fP
.RS
.B
     tcpdump -i xl0 'tcp[13] & 2 == 2'
.RE
.PP
Некоторые смещения и значения полей могут быть выражены в виде имен,
а не числовых значений. Например, tcp[13] может
быть заменен на tcp[флаги tcp]. Также доступны следующие
значения полей флага TCP: tcp-fin, tcp-syn, tcp-rst,
tcp-push, tcp-ack, tcp-urg, tcp-ece и tcp-cwr.
.PP
Это может быть продемонстрировано следующим образом:
.RS
.B
     tcpdump -i xl0 'tcp[tcpflags] & tcp-push != 0'
.RE
.PP
Обратите внимание, что вы должны использовать одинарные кавычки или обратную косую
черту в выражении, чтобы скрыть специальный символ AND ('&')
из оболочки.
.HD
.B
UDP Пакеты
.LP
UDP формат проиллюстрирован этим пакетом rwho:
.RS
.nf
.sp .5
\f(CWactinide.who > broadcast.who: udp 84\fP
.sp .5
.fi
.RE
Это говорит о том, что порт \fIwho\fP на хосте \fIactinide\fP отправил дейтаграмму UDP
на порт \fIwho\fP на хосте \fI broadcast\fP,
адрес широковещательной передачи в Интернете.
Пакет содержал 84 байта пользовательских данных.
.LP
Распознаются некоторые службы UDP (по
номеру порта источника или назначения) и выводится информация о протоколе более высокого уровня.
В частности, запросы на обслуживание доменных имен (RFC 1034/1035) и Sun
RPC вызывает NFS (RFC 1050).
.HD
TCP или UDP Запросы к серверу имен
.LP
\fI(N.B.:Следующее описание предполагает знакомство с
протоколом обслуживания домена, описанным в RFC 1035.
Если вы не знакомы
с протоколом, то следующее описание, как вам покажется, написано
на греческом языке.)\fP
.LP
Запросы к серверу имен форматируются следующим образом
.RS
.nf
.sp .5
\fIsrc > dst: id op? flags qtype qclass name (len)\fP
.sp .5
\f(CWh2opolo.1538 > helios.domain: 3+ A? ucbvax.berkeley.edu. (37)\fR
.sp .5
.fi
.RE
Хост \fIh2opolo\fP запросил у сервера домена на \fIhelios\fP запись
адреса (тип=A), связанную с именем \fI ucbvax.berkeley.edu.\fP
Идентификатор запроса был `3'.
Знак "+" указывает на то, что был установлен желаемый флаг рекурсии
\fI\fP.
Длина запроса составляла 37 байт, исключая TCP или UDP и
Заголовки IP-протоколов.
Операция запроса была обычной, \frequency\FP,
поэтому поле op было опущено.
Если бы оп был чем-то другим, он был
бы напечатан между "3" и `+".
Аналогично, класс был обычным,
\fic_in\FP, и опущен.
Любой другой класс был бы напечатан
сразу после буквы "А".
.LP
Проверяются некоторые отклонения, которые могут привести к появлению дополнительных полей, заключенных в
квадратные скобки:  Если запрос содержит ответ, официальные записи или
раздел дополнительных записей,
.IR ancount ,
.IR nscount ,
или
.I arcount
печатаются как `[\fIn\fp]", "[\fIn\fp]" или "[\fi\f Pau]", где \fIn\fP
- соответствующий округ.
Если задан какой-либо из битов ответа (код AA, RA или r) или любой из
битов "должно быть равно нулю" задан во втором и третьем байтах, выводится "[b2&3=\fIx\fP]",
где \fIx\fP - шестнадцатеричное значение заголовка второй и третий байты.
.HD
TCP или UDP Ответы Сервера Имен
.LP
Ответы сервера имен форматируются следующим образом
.RS
.nf
.sp .5
\fIsrc > dst:  id op rcode flags a/n/au type class data (len)\fP
.sp .5
\f(CWhelios.domain > h2opolo.1538: 3 3/3/7 A 128.32.137.3 (273)
helios.domain > h2opolo.1537: 2 NXDomain* 0/1/0 (97)\fR
.sp .5
.fi
.RE
В первом примере \fIhelios\fP отвечает на запрос с идентификатором 3 от \fIh2opolo\fP
с 3 записями ответов, 3 записями сервера имен и 7 дополнительными записями.
Первая запись ответа имеет тип A (адрес), а ее данные - это интернет
-адрес 128.32.137.3.
Общий размер ответа составил 273 байта,
не считая заголовков TCP, UDP и IP.
Код операции (запроса) и ответа
((Ошибки нет) были опущены, как и класс (C_IN) записи A.
.LP
Во втором примере \Fihelios\FP отвечает на запрос 2
кодом ответа несуществующего домена (nxdomain) без ответов,
с одним сервером имен и без записей полномочий.
Символ "*" указывает на то, что
был установлен бит \fI authoritous answer\fP.
Поскольку ответов не было,
тип, класс или данные не были напечатаны.
.LP
Другими символами флага, которые могут отображаться, являются `\-' (доступна рекурсия,
RA, \fInot\fP установлен) и `|' (усеченное сообщение, TC, установлено).
Если в
разделе "вопрос" не содержится ровно одной записи, печатается
"[\fIn\fPq]".
.HD
SMB/CIFS расшифровка
.LP
\fItcpdump\fP now includes fairly обширный SMB/CIFS/NBT расшифровка данных
на UDP/137, UDP/138 и TCP/139.
Также выполняется некоторое примитивное декодирование данных IPX и
NetBEUI SMB.
.LP
По умолчанию выполняется довольно минимальное декодирование,
но при использовании -v выполняется гораздо более подробное декодирование.
Имейте в виду, что при использовании -v один SMB-пакет
может занимать страницу или больше, поэтому используется -v только в том случае, если вам действительно нужны все
подробности.
.LP
Информацию о форматах пакетов SMB и значении всех полей смотрите в разделе
\%https://download.samba.org/pub/samba/specs/ и на других онлайн-ресурсах.
Исправления для SMB были написаны Эндрю Триджеллом
(Andrew Tridgell) (tridge@samba.org).
.HD
NFS Запросы и ответы
.LP
Sun NFS (Network File System) запросы и ответы печатаются в виде:
.RS
.nf
.sp .5
\fIsrc.sport > dst.nfs: NFS request xid xid len op args\fP
\fIsrc.nfs > dst.dport: NFS reply xid xid reply stat len op results\fP
.sp .5
\f(CW
sushi.1023 > wrl.nfs: NFS request xid 26377
	112 readlink fh 21,24/10.73165
wrl.nfs > sushi.1023: NFS reply xid 26377
	reply ok 40 readlink "../var"
sushi.1022 > wrl.nfs: NFS request xid 8219
	144 lookup fh 9,74/4096.6878 "xcolors"
wrl.nfs > sushi.1022: NFS reply xid 8219
	reply ok 128 lookup fh 9,74/4134.3150
\fR
.sp .5
.fi
.RE
В первой строке хост \fIsushi\fP отправляет транзакцию с идентификатором \fI26377\fP
на адрес \fIwrl\fP.
Объем запроса составил 112 байт,
не считая заголовков UDP и IP.
Операция представляла собой \fI readlink\fP
(чтение символьной ссылки) для дескриптора файла (\fIfh\fP) 21,24/10.731657119.
(Если повезет, как в данном случае, дескриптор файла можно интерпретировать
как пару основных и второстепенных номеров устройств, за которыми следуют номер индексного дескриптора и номер
поколения.) Во второй строке \fIwrl\fP отвечает "ок" с
тем же идентификатором транзакции и содержимым ссылки.
.LP
В третьей строке \fIsushi\fP запрашивает (используя новый идентификатор транзакции) \fIwrl\fP
для поиска имени `\fIxcolors\fP' в файле каталога 9,74/4096.6878. В
четвертой строке \fIwrl\fP отправляет ответ с соответствующим идентификатором транзакции.
.LP
Обратите внимание, что печатаемые данные
зависят от типа операции.
Формат должен быть понятен сам
по себе, если его читать в сочетании со
спецификацией протокола NFS.
Также обратите внимание, что более старые версии tcpdump печатали пакеты NFS в
несколько ином формате:
вместо номера порта пакета, отличного от NFS, печатался идентификатор транзакции (xid).
.LP
Если установлен флажок \-v (подробный), выводится дополнительная информация.
Например:
.RS
.nf
.sp .5
\f(CW
sushi.1023 > wrl.nfs: NFS request xid 79658
	148 read fh 21,11/12.195 8192 bytes @ 24576
wrl.nfs > sushi.1023: NFS reply xid 79658
	reply ok 1472 read REG 100664 ids 417/0 sz 29388
\fP
.sp .5
.fi
.RE
(\-v также выводит поля TTL, ID, длина и фрагментация заголовка IP,
которые были опущены в этом примере.)  В первой строке,
\\fIsushi\fP запрашивает \tiwari\fP для чтения 8192 байт из файла 21,11/
12.195 со смещением в байтах 24576.
\fIWrl\fP отвечает "ок"; пакет, показанный во
второй строке, является первым фрагментом ответа и, следовательно, имеет всего 1472
длина в байтах (остальные байты будут приведены в последующих фрагментах, но
эти фрагменты не имеют заголовков NFS или даже UDP и поэтому могут не
печататься, в зависимости от используемого выражения фильтра).
Поскольку задан флаг \-v,
выводятся некоторые атрибуты файла (которые возвращаются в дополнение
к данным файла): тип файла (`REG", для обычного файла),
режим файла (в восьмеричном формате), UID и GID GID и размер файла.
.LP
Если флаг \-v указан более одного раза, выводится еще больше сведений.
.LP
Ответные пакеты NFS явно не идентифицируют операцию RPC.
Вместо,
\fItcpdump\fP отслеживает `последние" запросы и сопоставляет их с
ответами, используя идентификатор транзакции.
Если ответ не соответствует
соответствующему запросу, он может быть недоступен для синтаксического анализа.
.HD
AFS Запросы и ответы
.LP
Запросы и ответы Transarc AFS (файловая система Andrew) печатаются
в виде:
.HD
.RS
.nf
.sp .5
\fIsrc.sport > dst.dport: rx packet-type\fP
\fIsrc.sport > dst.dport: rx packet-type service call call-name args\fP
\fIsrc.sport > dst.dport: rx packet-type service reply call-name args\fP
.sp .5
\f(CW
elvis.7001 > pike.afsfs:
	rx data fs call rename old fid 536876964/1/1 ".newsrc.new"
	new fid 536876964/1/1 ".newsrc"
pike.afsfs > elvis.7001: rx data fs reply rename
\fR
.sp .5
.fi
.RE
В первой строке хост elvis отправляет RX-пакет pike.
Это был
RX-пакет данных для службы fs (файлового сервера) и является началом
вызова RPC.
Вызовом RPC было переименование со старым идентификатором файла каталога
536876964/1/1 и старым именем файла ".newsrc.new", а также с новым
идентификатором файла каталога 536876964/1/1 и новым именем файла `.newsrc".
Хост-сервер pike
отвечает RPC-ответом на вызов переименования (который прошел успешно, поскольку
это был пакет данных, а не пакет прерывания).
.LP
В общем, все RPC AFS декодируются, по крайней мере, по имени вызова RPC.
Наиболее
В RPC AFS расшифрованы, по крайней мере, некоторые аргументы (обычно только
"интересные" аргументы, для некоторого определения интересного).
.LP
Этот формат предназначен для самоописания, но, вероятно
, он не будет полезен людям, которые не знакомы с работой
AFS и RX.
.LP
Если дважды задан флаг -v (подробный), выводятся пакеты подтверждения и
дополнительная информация в заголовке, такая как идентификатор вызова RX
, номер вызова, порядковый номер, серийный номер и флаги пакетов RX.
.LP
Если флаг -v указан дважды, выводится дополнительная информация,
такая как идентификатор вызова RX, серийный номер и флаги пакетов RX.
Информация о согласовании MTU также выводится из пакетов подтверждения RX.
.LP
Если флажок -v задан три раза, печатаются индекс безопасности и идентификатор
службы.
.LP
Коды ошибок выводятся для пакетов прерывания, за исключением
пакетов-маяков Ubik (поскольку пакеты прерывания используются для обозначения одобрения
протокола Ubik).
.LP
AFS ответные пакеты явно не идентифицируют операцию RPC.
Вместо,
\fItcpdump\fP отслеживает `последние" запросы и сопоставляет их с
ответами, используя номер вызова и идентификатор службы.
Если ответ не
соответствует
соответствующему запросу, его может быть невозможно проанализировать.

.HD
KIP AppleTalk (DDP in UDP)
.LP
Пакеты AppleTalk DDP, инкапсулированные в дейтаграммы UDP,
деинкапсулируются и сбрасываются как пакеты DDP (т.е. вся информация заголовка UDP
отбрасывается).
The file
.I /etc/atalk.names
используется для преобразования номеров сетей AppleTalk и узлов в имена.
Строки в этом файле имеют вид
.RS
.nf
.sp .5
\fInumber	name\fP

\f(CW1.254		ether
16.1		icsd-net
1.254.110	ace\fR
.sp .5
.fi
.RE
В первых двух строках указаны названия сетей AppleTalk.
В третьей
строке указано имя конкретного хоста (хост отличается
от сети по 3-му октету в номере \-
номеру сети\, который должен соответствовать\У fP есть два октета, а у номера хоста \fImust\fP
должно быть три октета.)  Номер и имя должны быть разделены
пробелами (пробелами или символами табуляции).

.I /etc/atalk.names
файл может содержать пустые строки или строки комментариев (строки, начинающиеся с
a `#').
.LP
AppleTalk адреса печатаются в формеm
.RS
.nf
.sp .5
\fInet.host.port\fP

\f(CW144.1.209.2 > icsd-net.112.220
office.2 > icsd-net.112.220
jssmag.149.235 > icsd-net.2\fR
.sp .5
.fi
.RE
(If the
.I /etc/atalk.names
не существует или не содержит записи для некоторого
номера узла/сети AppleTalk, адреса печатаются в числовом виде.)
В первом примере NBP (порт DDP 2) на узле 209 net 144.1
отправляет данные на все, что прослушивает порт 220 узла 112 icsd сети.
Вторая строка такая же, за исключением того, что известно полное имя исходного узла
(`office").
Третья строка представляет собой отправку с порта 235 на
сетевом узле jssmag 149 для широковещательной передачи на порт icsd-net NBP (обратите внимание, что
широковещательный адрес (255) обозначен сетевым именем без
номера хоста\- по этой причине рекомендуется сохранять имена узлов и
сетевые имена, отличные от /etc/atalk.names).
.LP
NBP (протокол привязки имен) и ATP (протокол транзакций AppleTalk)
содержимое пакетов интерпретируется.
Другие протоколы просто передают
имя протокола (или номер, если для протокола не зарегистрировано имя)
и размер пакета.

\fBNBP packets\fP отформатированы так, как показано в следующих примерах:
.RS
.nf
.sp .5
\f(CWicsd-net.112.220 > jssmag.2: nbp-lkup 190: "=:LaserWriter@*"
jssmag.209.2 > icsd-net.112.220: nbp-reply 190: "RM1140:LaserWriter@*" 250
techpit.2 > icsd-net.112.220: nbp-reply 190: "techpit:LaserWriter@*" 186\fR
.sp .5
.fi
.RE
Первая строка - это запрос на поиск имени для laserwriters, отправленный хостом net icsd
112 и транслируемый в net jssmag.
Идентификатор nb для поиска равен 190.
Во второй строке показан ответ на этот запрос (обратите внимание, что он имеет тот
же идентификатор) от хоста jssmag.209, в котором говорится,
что на порту 250 зарегистрирован ресурс laserwriter с именем "RM1140".
Третья строка - это
еще один ответ на тот же запрос, в котором говорится, что у hosttech pit есть laserwriter
""tech pit", зарегистрированный на порту 186.

\fBATP packet\fP форматирование демонстрируется на следующем примере:
.RS
.nf
.sp .5
\f(CWjssmag.209.165 > helios.132: atp-req  12266<0-7> 0xae030001
helios.132 > jssmag.209.165: atp-resp 12266:0 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:1 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:2 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:3 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:4 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:5 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:6 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp*12266:7 (512) 0xae040000
jssmag.209.165 > helios.132: atp-req  12266<3,5> 0xae030001
helios.132 > jssmag.209.165: atp-resp 12266:3 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:5 (512) 0xae040000
jssmag.209.165 > helios.132: atp-rel  12266<0-7> 0xae030001
jssmag.209.133 > helios.132: atp-req* 12267<0-7> 0xae030002\fR
.sp .5
.fi
.RE
Jssmag.209 инициирует транзакцию с идентификатором 12266 с хостом helios, запрашивая
до 8 пакетов (`<0-7>").
Шестнадцатеричное число в конце строки
является значением поля `пользовательские данные" в запросе.
.LP
Helios отправляет в ответ 8 пакетов по 512 байт.
Цифра ":", следующая
за идентификатором транзакции, указывает порядковый номер пакета в транзакции,
а число в скобках - объем данных в пакете,
за исключением заголовка ATP.
Символ "*" в пакете 7 указывает на то, что
бит EOM был установлен.
.LP
Затем Jssmag.209 запрашивает повторную передачу пакетов 3 и 5.
Helios
повторно отправляет их, после чего jssmag.209 завершает транзакцию.
Наконец,
jssmag.209 инициирует следующий запрос.
Символ "*" в запросе
указывает на то, что XO ("ровно один раз") был установлен \fInot\fP.

.SH ОБРАТНАЯ СОВМЕСТИМОСТЬ
TCP наименования флажков
.B tcp-ece
и
.B tcp-cwr
стал доступен при подключении к libpcap версии 1.9.0 или более поздней.

.SH "СМОТРЕТЬ ТАКЖЕ"
.BR stty (1),
.BR pcap (3PCAP),
.BR bpf (4),
.BR nit (4P),
.BR \%pcap-savefile (5),
.BR \%pcap-filter (7),
.BR \%pcap-tstamp (7)
.LP
.RS
.na
.I https://www.iana.org/assignments/media-types/application/vnd.tcpdump.pcap
.ad
.RE
.LP
.SH АВТОРЫ
Первоначальными авторами являются:
.LP
Ван Джейкобсон,
Крейг Лерес и
Стивен Маккэнн, все из
Национальной лаборатории Лоуренса Беркли, Калифорнийский университет, Беркли, Калифорния.
.LP
В настоящее время он поддерживается группой Tcpdump.
.LP
Текущая версия доступна по протоколу HTTPS:
.LP
.RS
.I https://www.tcpdump.org/
.RE
.LP
Исходный дистрибутив доступен по анонимному ftp:
.LP
.RS
.I ftp://ftp.ee.lbl.gov/old/tcpdump.tar.Z
.RE
.LP
Поддержка IPv6/IPSec добавлена проектом WIDE/KAME.
Эта программа использует OpenSSL/LibreSSL в определенных конфигурациях.
.SH ПРОБЛЕМЫ
Чтобы сообщить о проблеме с системой безопасности, пожалуйста, отправьте электронное письмо по адресу \%security@tcpdump.org.
.LP
Чтобы сообщать об ошибках и других проблемах, вносить исправления, запрашивать
функцию, предоставлять общие отзывы и т.д. пожалуйста, ознакомьтесь с файлом
.I CONTRIBUTING.md
в корне древа исходных текстов tcpdump.
.LP
NIT не позволяет вам отслеживать ваш собственный исходящий трафик, а BPF позволяет.
Мы рекомендуем использовать последний вариант.
.LP
В системах Linux с ядрами версии 2.0[.x]:
.IP
пакеты на устройстве обратной связи будут видны дважды;
.IP
фильтрация пакетов не может быть выполнена в ядре, поэтому все пакеты должны
быть скопированы из ядра для фильтрации в пользовательском режиме;
.IP
весь пакет, а не только та его часть, которая находится в пределах длины моментального снимка,
будет скопирован из ядра (механизм захвата пакетов версии 2.0[.x], если
его попросят скопировать только часть пакета в пользовательское пространство, не сообщит
истинную длину пакета; это приведет к тому, что большинство IP-адресов будут заблокированы). пакеты, из которых нужно получить
сообщение об ошибке
.BR tcpdump );
.IP
запись на некоторых устройствах PPP будет работать некорректно.
.LP
Мы рекомендуем вам обновиться до версии 2.2 или более поздней версии ядра.
.LP
Следует предпринять некоторые попытки для повторной сборки IP-фрагментов или, по крайней
мере, для вычисления правильной длины для протокола более высокого уровня.
.LP
Имя обратных запросов сервер не свалил правильно: (пустая)
раздел Вопрос-напечатаны, а не реального запроса в ответ
раздел.
Некоторые считают, что обратные запросы сами по себе являются ошибкой, и
предпочитают исправлять их в программе, генерирующей их, а не в \fItcpdump\fP.
.LP
Трассировка пакетов, которая пересекает переход на летнее время, даст
искаженные временные метки (изменение времени игнорируется).
.LP
Выражения фильтрации для полей, отличных от тех, которые указаны в заголовках Token Ring,
не будут корректно обрабатывать пакеты Token Ring, маршрутизируемые из источника.
.LP
Выражения фильтрации для полей, отличных от тех, что указаны в заголовках 802.11, не
будут корректно обрабатывать пакеты данных стандарта 802.11 с установленными параметрами Todd и From DS.
.LP
.BR "ip6 proto"
следовало бы преследовать цепочку заголовков, но в данный момент этого не происходит.
.BR "ip6 protochain"
предоставляется для такого поведения.
.LP
Арифметическое выражение для заголовков транспортного уровня, например \fBtcp[0]\fP,
не работает с пакетами IPv6.
Оно просматривает только пакеты IPv4.
