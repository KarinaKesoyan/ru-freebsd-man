.Dd 11 августа 2018 г.
.Dt "AT" 1
.Os
.Sh ИМЯ
.Nm at ,
.Nm batch ,
.Nm atq ,
.Nm atrm
.Nd постановка в очередь, проверка или удалениеq заданий, предназначенных для последующего выполнения
.Sh СИНТАКСИС
.Nm at
.Op Fl q Ar queue
.Op Fl f Ar file
.Op Fl mldbv
.Ar time
.Nm at
.Op Fl q Ar queue
.Op Fl f Ar file
.Op Fl mldbv
.Fl t
.Sm off
.Op Oo Ar CC Oc Ar YY
.Ar MM DD hh mm Op . Ar SS
.Sm on
.Nm at
.Fl c Ar job Op Ar job ...
.Nm at
.Fl l Op Ar job ...
.Nm at
.Fl l
.Fl q Ar queue
.Nm at
.Fl r Ar job Op Ar job ...
.Pp
.Nm atq
.Op Fl q Ar queue
.Op Fl v
.Pp
.Nm atrm
.Ar job
.Op Ar job ...
.Pp
.Nm batch
.Op Fl q Ar queue
.Op Fl f Ar file
.Op Fl mv
.Op Ar time
.Sh ОПИСАНИЕ
Утилиты
.Nm at
и
.Nm batch
читают из стандартного ввода или указанного файла комманды, которые необходимо
выполнить позже, используя
Xr sh 1 .
.Bl -tag -width indent
.It Nm at
выполняет команды в указанное время;
.It Nm atq
выводит список ожидающих заданий пользователя, если только пользователь не является суперпользователем; в этом
случае выводятся задания всех пользователей;
.It Nm atrm
удаляет задания;
.It Nm batch
выполняет команды, когда позволяет уровень загрузки системы; другими словами, когда
средняя нагрузка падает ниже 1,5-кратного количества активных процессоров,
или значения, указанного при вызове
.Nm atrun .
.El
.Pp
Утилита
.Nm at
позволяет работать с умеренно сложными
.Ar time
характеристиками.
Оно допускает указание времени в формате
.Ar HHMM
или
.Ar HH:MM
для запуска задания в определенное время суток.
(Если это время уже прошло, предполагается, что наступит следующий день.)
В качестве альтернативы могут быть указаны следующие ключевые слова:
.Em midnight ,
.Em noon ,
или
.Em teatime
(4pm),
также время суток может быть дополнено суффиксами
.Em AM
или
.Em PM
для бега утром или вечером.
Также можно задать день запуска задания,
указав дату в форме
.Ar \%month-name day
(имя-месяца день)
с возможным добавлением года
.Ar year ,
или указать дату в следующих форматах
.Ar DD.MM.YYYY ,
.Ar DD.MM.YY ,
.Ar MM/DD/YYYY ,
.Ar MM/DD/YY ,
.Ar MMDDYYYY или
.Ar MMDDYY .
Указание даты должно соответствовать указанию
время суток.
Время также можно указать как:
.Op Em now
.Em + Ar count \%time-units ,
где в качестве time-units могут быть указаны следующие единицы времени:
.Em minutes ,
.Em hours ,
.Em days ,
.Em weeks ,
.Em months
или
.Em years .
Команде
.Nm
может быть поручено запустить задание сегодня, добавив к времени слово
.Em today
или запустить задание завтра, добавив к времени слово
.Em tomorrow .
.Pp
Например, чтобы запустить задание в 16:00 через три дня, используйте
.Nm at Ar 4pm + 3 days ,
чтобы запустить задание в 10:00 31 июля, используйте
.Nm at Ar 10am Jul 31
и чтобы запустить задание завтра в 1 час ночи, используйте
.Nm at Ar 1am tomorrow .
.Pp
Утилита
.Nm at
также поддерживает формат времени
.Tn POSIX
(смотри параметр
.Fl t ).
.Pp
Обе утилиты
.Nm
и
.Nm batch ,
считывают команды со стандартного ввода или из указанного файла,
если задан параметр
.Fl f .
Рабочий каталог, окружение (кроме переменных
.Ev TERM ,
.Ev TERMCAP ,
.Ev DISPLAY
и
.Em _ )
и
.Ar umask
сохраняются с момента вызова.
Команды
.Nm
или
.Nm batch ,
вызываемые из оболочки
.Xr su 1
сохраняют текущий идентификатор пользователя.
Пользователю будут отправлены по почте стандартный вывод ошибок (stderr) и стандартный вывод (stdout)  его
команды, если они есть.
Письмо будет отправлено с помощью команды
.Xr sendmail 8 .
Если команда
.Nm
выполняется из оболочки
.Xr su 1 ,
почту получит владелец оболочки login.
.Pp
Суперпользователь может использовать эти команды в любом случае.
Для других пользователей разрешение на использование
.Nm
определяется файлами
.Pa /var/at/at.allow
и
.Pa /var/at/at.deny .
.Pp
Если файл
.Pa /var/at/at.allow
существует, только упомянутым в нем пользователямнам разрешено использование
.Nm .
В этих двух файлах пользователь считается указанным только в том случае, если перед
его именем в строке нет пробелов или других символов, а
символ новой строки размещен сразу после имени, даже если это конец
файла.
Остальные строки игнорируются и могут использоваться для комментариев.
.Pp
Если
.Pa /var/at/at.allow
не существует, проверяется файл
.Pa /var/at/at.deny ,
при этом любое имя пользователя, не упомянутое в нем, будет разрешено
использовать
.Nm .
.Pp
Если ни один из них не существует, только суперпользователю разрешено использовать
.Nm .
Это конфигурация по умолчанию.
.Sh ОСОБЕННОСТИ РЕАЛИЗАЦИИ
Обратите внимание, что
.Nm
реализуется посредством демона
.Xr cron 8 ,
вызывающего
.Xr atrun 8
каждые пять минут.
Это означает, что степень детализации
.Nm
может быть неоптимальным для каждого случая использования.
Если требуется более мелкая детализация, можно отредактировать файл
.Pa /etc/cron.d/at
и он будет прочитан системным демоном crontab, из которого
тот унаследует переменные среды
.Ev SHELL 
и
.Ev PATH .
.Sh ПАРАМЕТРЫ
.Bl -tag -width indent
.It Fl q Ar queue
Использовать очередь, указанную в параметре queue.
Обозначение очереди состоит из одной буквы; действительные обозначения очереди
диапазон от
.Ar a
to
.Ar z
и
.Ar A
to
.Ar Z .
Имя очереди
.Ar c
является значением по умолчанию для
.Nm ,
а имя очереди
.Ar E
для
.Nm batch .
Очереди с заглавными буквами выполняются с повышенным приоритетом (niceness).
Если задание отправлено в очередь, обозначенную заглавной буквой, оно
рассматривается так, как если бы он был отправлен batch только что.
Если для
.Nm atq
задана определенная очередь, будут показаны только задания, ожидающие выполнения в этой очереди.
.It Fl m
Отправлять письмо пользователю после завершения задания, даже если задание
ничего не вывело.
.It Fl f Ar file
Прочитать задание из файла
.Ar file
вместо стандартного ввода.
.It Fl l
Без аргументов, вывести список всех заданий для вызвавшего пользователя.
Если указаны номера одной или нескольких
номеров задач, то вывести только эти задачи.
.It Fl d
Является псевдонимом для
.Nm atrm
(этот параметр устарел; используйте вместо него
.Fl r ).
.It Fl b
Является псевдонимом для
.Nm batch .
.It Fl v
Для
.Nm atq ,
показызать выполненные, но еще не удаленные задания в очереди; в противном случае
показать время выполнения заданий.
.It Fl c
Вывести задания, перечисленные в командной строке, в стандартный вывод.
.It Fl r
Удалить указанные задания.
.It Fl t
Задать время задания, используя формат времени \*[Px].
Аргумент должен быть задан в формате
.Sm off
.Op Oo Ar CC Oc Ar YY
.Ar MM DD hh mm Op . Ar SS
.Sm on
где каждая пара букв означает следующее:
.Pp
.Bl -tag -width indent -compact -offset indent
.It Ar CC
Первые две цифры года (столетия).
.It Ar YY
Последние две цифры года.
.It Ar MM
Месяц года от 1 до 12.
.It Ar DD
День месяца, от 1 до 31
.It Ar hh
Час дня от 0 до 23.
.It Ar mm
Минуты часа от 0 до 59.
.It Ar SS
Секунда минуты от 0 до 60.
.El
.Pp
Если пары букв
.Ar CC
и
.Ar YY
не указаны, значением по умолчанию считается текущий
год.
Если не указана пара букв
.Ar SS ,
значение по умолчанию равно 0.
.El
.Sh ФАЙЛЫ
.Bl -tag -width /var/at/jobs/.lockfile -compact
.It Pa /var/at/jobs
каталог, содержащий файлы заданий
.It Pa /var/at/spool
каталог, содержащий файлы вывода spool
.It Pa /var/run/utx.active
записи входа в систему
.It Pa /var/at/at.allow
разрешающие настройки доступа
.It Pa /var/at/at.deny
запрещающие настройки допустпа
.It Pa /var/at/jobs/.lockfile
файл блокировки для созданного задания
.El
.Sh СМОТРИ ТАКЖЕ
.Xr nice 1 ,
.Xr sh 1 ,
.Xr umask 2 ,
.Xr atrun 8 ,
.Xr cron 8 ,
.Xr sendmail 8
.Sh АВТОРЫ
.An -nosplit
В основном страница документации была написана
.An Thomas Koenig Aq Mt ig25@rz.uni-karlsruhe.de .
Процедуры работы с форматами времени написаны
.An David Parsons Aq Mt orc@pell.chi.il.us ,
с небольшими улучшениями от
.An Joe Halpin Aq Mt joe.halpin@attbi.com .
.Sh ПРОБЛЕМЫ
Если файл
.Pa /var/run/utx.active
недоступен или поврежден, или если пользователь не вошел в систему в
момент вызова
.Nm ,
почта отправляется на идентификатор пользователя (userid),
содержащийся в переменной окружения
.Ev LOGNAME .
Если она не определена или пуста, предполагается использование текущего идентификатора пользователя.
.Pp
The
.Nm at
и
.Nm batch
коммунальные услуги
реализованные в настоящее время, не подходят, когда пользователи конкурируют за
Ресурсы.
В этом случае можно использовать другую пакетную систему, такую как
.Em nqs
может быть более подходящим.
.Pp
Указание даты после 2038 года может не работать в некоторых системах.
