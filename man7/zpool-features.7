.\"
.\" Copyright (c) 2012, 2018 by Delphix. Все права защищены.
.\" Copyright (c) 2013 by Saso Kiselkov. Все права защищены.
.\" Copyright (c) 2014, Joyent, Inc. Все права защищены.
.\" На содержимое этого файла распространяются условия Лицензии на общую разработку
.\" и Лицензии на распространение ("Лицензия").  Вы можете использовать этот файл только
.\" в соответствии с Лицензией. Вы можете получить копию лицензии по адресу
.\" usr/src/OPENSOLARIS.LICENSE или https://opensource.org/licenses/CDDL-1.0.
.\"
.\" Конкретные формулировки, регулирующие разрешения и
.\" ограничения в соответствии с Лицензией. При распространении Охватываемого кода включите этот
.\" CDDL HEADER в каждый файл и включайте файл Лицензии по адресу
.\" usr/src/OPENSOLARIS.LICENSE.  Если применимо, добавьте следующее ниже этого
.\" CDDL HEADER, при этом поля, заключенные в скобки "[]", замените своей
.\" собственной идентификационной информацией:
.\" Часть Авторское право [yyyy] [имя владельца авторских прав]
.\" Copyright (c) 2019, Klara Inc.
.\" Copyright (c) 2019, Allan Jude
.\" Copyright (c) 2021, Colm Buckley <colm@tuatha.org>
.\"
.Dd 23 июня 2022 г.
.Dt ZPOOL-FEATURES 7
.Os
.
Sh ИМЯ
.Nm zpool-features
.Nd описание функций пула ZFS
.
.Sh ОПИСАНИЕ
Версии формата пула ZFS на диске указываются через
.Dq функции 
которые заменяют старые номера форматов дисков.
.Pq последний поддерживаемый номер формата диска - 28 .
Чтобы включить функцию в пуле, используйте команду
.Nm zpool Cm upgrade ,
или установить
.Sy feature Ns @ Ns Ar feature-name
свойство
.Sy enabled .
Также см.
Наборы функций совместимости .Sx
для получения информации о том, как наборы функций могут быть включены вместе.
.Pp
Формат пула не влияет на совместимость версий файловых систем и возможность
пересылать файловые системы между пулами.
.Pp
Поскольку большинство функций могут быть включены независимо друг от друга, дисковый
формат пула определяется набором всех функций, отмеченных как
.Sy активным
в пуле.
Если пул был создан с помощью другой версии программного обеспечения
этот набор может включать неподдерживаемые функции.
.
.Ss Идентификация функций
Каждая функция имеет GUID вида
.Ar com.example : Ns Ar feature-name .
Обращенное DNS-имя обеспечивает уникальность GUID функции во всех реализациях ZFS.
реализации ZFS.
Если в пуле встречаются неподдерживаемые функции, они будут
будут идентифицироваться по их GUID.
Обратитесь к документации по реализации ZFS
в которой создан пул, для получения информации об этих функциях.
.Pp
Каждая поддерживаемая функция также имеет короткое имя.
По соглашению, короткое имя функции - это часть ее GUID, которая следует
по адресу
.Sq \&:
.Po
т. е.
.Ar com.example : Ns Ar feature-name
будет иметь короткое имя
.Ar feature-name
.Pc ,
однако короткое имя функции может отличаться в разных реализациях ZFS, если
следование соглашению приведет к именному конфликту.
.
.Ss Состояния признаков
Функции могут находиться в одном из трех состояний:
.Bl -tag -width "отключено"
.It Sy активное
Изменения формата на диске, произведенные этой функцией, действуют на пул.
Поддержка этой функции необходима для импорта пула в режиме чтения-записи.
Если эта функция не совместима с режимом "только чтение",
для импорта пула в режиме только для чтения также требуется его поддержка.
.Pq см. Sx Совместимость только для чтения .
.It Sy включено
Администратор отметил эту функцию как включенную в пуле, но
изменения формата на диске еще не произошло.
Пул по-прежнему можно импортировать с помощью программного обеспечения, которое не поддерживает эту функцию,
но в любой момент могут быть внесены изменения в формат диска
что приведет к перемещению функции в
.Sy активное
состояние.
Некоторые функции могут поддерживать возврат в состояние
.Sy активированный
после того, как они становятся
.Sy активными.
Подробности см. в документации по конкретной функции.
.It Sy отключен
Изменения формата диска для этой функции не производились и не будут производиться
пока администратор не переведет функцию в 
.Sy включенное
состояние.
Функции нельзя отключить, если они были включены.
.El
.Pp
Состояние поддерживаемых функций отображается через свойства пула вида
.Sy функция Ns @ Ns Ar короткое имя .
.
.Ss Совместимость только для чтения
Некоторые функции могут вносить изменения в формат диска, которые не мешают другим программам
возможности других программ читать из пула.
Такие функции называются
.Dq совместимыми только для чтения.
Если все неподдерживаемые функции в пуле совместимы только для чтения,
пул можно импортировать в режиме только для чтения, установив параметр
.Sy readonly
во время импорта
.Po см.
.Xr zpool-import 8
для получения подробной информации об импорте пулов
.Pc .
.
.Ss Неподдерживаемые функции
Для каждой неподдерживаемой функции, включенной в импортируемом пуле, свойство пула
с именем
.Sy неподдерживаемая функция Ns @ Ns Ar feature-name
будет указывать, почему импорт был разрешен, несмотря на неподдерживаемую функцию.
Возможные значения для этого свойства следующие:
.Bl -tag -width "readonly"
.It Sy неактивный
Функция находится в режиме
.Sy включено
и поэтому формат пула на диске
совместим с программным обеспечением, не поддерживающим эту функцию.
.It Sy readonly
Функция совместима только с чтением, и пул был импортирован в режиме
только для чтения.
.El
.
.Ss Зависимости функций
Для работы некоторых функций необходимо, чтобы другие функции были включены.
Включение функции автоматически включает все функции, от которых она зависит.
.
.Ss Наборы функций совместимости
Иногда необходимо, чтобы пул поддерживал совместимость с
определенным форматом диска путем включения и отключения определенных функций.
Для этого используется
.Sy совместимость 
облегчает эту задачу, позволяя считывать наборы функций из текстовых файлов.
Если установить значение
.Sy off
.Pq наборы функций по умолчанию ,
наборы функций совместимости отключены
.Pq, то есть все функции включены;
при установке значения
.Sy legacy ,
никакие функции не включаются.
Если задан список имен файлов, разделенных запятыми
.Po
каждое имя файла может быть либо абсолютным путем, либо относительным
.Pa /etc/zfs/compatibility.d
или
.Pa /usr/share/zfs/compatibility.d
.Pc ,
списки запрашиваемых функций считываются из этих файлов,
разделенные пробелами и/или запятыми.
Включаются только функции, присутствующие во всех файлах.
.Pp
К файлам применяются простые проверки на вменяемость:
они должны быть размером от 1 B до 16 KiB и должны заканчиваться символом новой строки.
.Pp
Запрошенные функции применяются при создании пула с помощью команды
.Nm zpool Cm create Fl o Sy compatibility Ns = Ns Ar ...
и определяет, какие функции будут включены при использовании
.Nm zpool Cm upgrade .
.Nm zpool Cm status
не будет показывать предупреждение об отключенных функциях, которые не являются частью
запрашиваемого набора функций.
.Pp
Специальное значение
.Sy legacy
предотвращает включение любых функций либо через
.Nm zpool Cm upgrade
или
.Nm zpool Cm set Sy feature Ns @ Ns Ar feature-name Ns = Ns Sy enabled .
Эта настройка также предотвращает обновление пулов до более новых версий на диске.
Это мера безопасности для предотвращения случайного включения новых функций и нарушения совместимости.
.Pp
По соглашению, файлы совместимости в
.Pa /usr/share/zfs/compatibility.d
предоставляются дистрибутивом и включают наборы функций
поддерживаемые главными версиями популярных дистрибутивов, и наборы функций, обычно поддерживаемые в начале каждого года.
Файлы совместимости в
.Pa /etc/zfs/compatibility.d ,
если они есть, будут иметь приоритет над файлами с тем же именем в
.Pp
Если в этих файлах обнаружена нераспознанная функция, будет выдано сообщение об ошибке
Если нераспознанная функция находится в файле в каталоге
.Pa /etc/zfs/compatibility.d ,
это будет расценено как ошибка, и обработка будет остановлена.
Если нераспознанная функция находится в файле
.Pa /usr/share/zfs/compatibility.d ,
это расценивается как предупреждение, и обработка будет продолжена.
Это различие сделано для того, чтобы дистрибутивы могли включать функции
которые могут быть не распознаны установленными в данный момент двоичными файлами.
.Pp
Файлы совместимости могут содержать комментарии:
любой текст из
.Sq #
до конца строки игнорируется.
.Pp
.Sy Пример :
.Bd -literal -compact -offset 4n
.No пример# Nm cat Pa /usr/share/zfs/compatibility.d/grub2
# Функции, поддерживаемые GRUB2
async_destroy
bookmarks
embedded_data
empty_bpobj
enabled_txg
extensible_dataset
filesystem_limits
hole_birth
large_blocks
livelist
lz4_compress
spacemap_histogram
zpool_checkpoint

.No example# Nm zpool Cm create Fl o Sy compatibility Ns = Ns Ar grub2 Ar bootpool Ar vdev
.Ed
.Pp
См.
.Xr zpool-create 8
и
.Xr zpool-upgrade 8
для получения дополнительной информации о том, как эти команды зависят от наборов функций.
.
.de особенность 
.It Sy \\\\$2
.Bl -tag -compact -width "READ-ONLY COMPATIBLE"
.It GUID
.Sy \\\$1:\\\$2
.if !"\\\$4""\{\
.It DEPENDENCIES
\fB\\$4\fP\c
.если !"\\\$5" , \fB\\\$5\fP\c
.если !"\\\\$6" , \fB\\\$6\fP\c
.if !"\\\\$7" , \fB\\\$7\fP\c
.if !"\\\\$8" , \fB\\\$8\fP\c
.if !"\\\\$9" , \fB\\\$9\fP\c
.\}
.It READ-ONLY COMPATIBLE
\\$3
.El
.Pp
..
.
.ds instant-never \
.No Эта функция становится Sy активной No, как только она включается \\
и никогда не вернется к тому, чтобы быть включенной.
.
.ds remount-upgrade \
. No Каждая файловая система будет автоматически обновляться при повторном монтировании,\
или при создании нового файла в этой файловой системе. \
Обновление также может быть запущено на файловых системах с помощью \
Nm zfs Cm set Sy version Ns = Ns Sy current Ar fs . \
No Процесс обновления выполняется в фоновом режиме и может занять некоторое время \
для файловых систем, содержащих большое количество файлов .
.
.de checksum-spiel
Когда
.Sy \\$1
функция установлена на
.Sy включена ,
администратор может включить
.Sy \\$1
контрольную сумму для любого набора данных, используя
.Nm zfs Cm set Sy checksum Ns = Ns Sy \\\$1 Ar dset
.Po см. Xr zfs-set 8 Pc .
Эта функция становится
.Sy активной
как только
.Sy контрольная сумма
стала принимать значение
.Sy \\$1 ,
и вернется в состояние
.Sy включен 
как только все файловые системы, для которых когда-либо была установлена контрольная сумма
.Sy \\$1
будут уничтожены.
..
.
.Sh FEATURES
В этой системе поддерживаются следующие функции:
.Bl -tag -width Ds
.feature org.zfsonlinux allocation_classes yes
Эта функция включает поддержку отдельных классов распределения.
.Pp
Эта функция становится
.Sy активной
когда выделенный класс распределения vdev
.Pq dedup или special
создается с помощью команд
.Nm zpool Cm create No или Nm zpool Cm add No .
При удалении устройства его можно вернуть в состояние
.Sy включено
если удалить все выделенные устройства vdev класса распределения.
.
.feature com.delphix async_destroy yes
Уничтожение файловой системы требует обхода всех ее данных, чтобы
вернуть использованное пространство в пул.
Без
.Sy async_destroy ,
файловая система не будет полностью удалена, пока все пространство не будет возвращено.
Если операция уничтожения прерывается перезагрузкой или отключением питания,
следующая попытка открыть пул должна будет завершить операцию уничтожения синхронно.
.Pp
Когда
.Sy async_destroy
включена, данные файловой системы будут восстановлены фоновым процессом,
что позволяет завершить операцию уничтожения
не обходя всю файловую систему.
Фоновый процесс может возобновить
прерванное уничтожение после открытия пула, что устраняет необходимость
завершать прерванное уничтожение в рамках операции открытия.
Объем пространства, оставшегося для освобождения фоновым процессом
доступен через
.Sy освобождение
свойство.
.Pp
Это свойство только
.Sy активно
пока
.Sy освобождение 
не является нулевым.
.
.feature org.openzfs blake3 no extensible_dataset
Эта функция позволяет использовать хэш-алгоритм BLAKE3 для контрольной суммы и
дедупликации.
BLAKE3 - это безопасный хэш-алгоритм, ориентированный на высокую производительность.
.Pp
.checksum-spiel blake3
.
.feature com.fudosecurity block_cloning yes
Когда эта функция включена, ZFS будет использовать клонирование блоков для таких операций, как
.Fn copy_file_range 2 .
Клонирование блоков позволяет создавать несколько ссылок на один блок.
Это намного быстрее, чем копирование данных (так как фактические данные не считываются и не записываются), и не занимает дополнительного места.
Блоки можно клонировать между наборами данных при некоторых условиях (например, при отключенном
шифровании и одинаковом
.Nm размере записи ) .
.Pp
Эта функция становится
.Sy активной
когда клонируется первый блок.
Когда последний клонированный блок освобождается, она возвращается во включенное состояние.
.feature com.delphix bookmarks yes extensible_dataset
Эта функция позволяет использовать
.Nm zfs Cm bookmark
команду.
.Pp
Эта функция
.Sy активна
пока в пуле существуют какие-либо закладки.
Список всех закладок в пуле можно получить, выполнив команду
.Nm zfs Cm list Fl t Sy bookmark Fl r Ar poolname .
.
.feature com.datto bookmark_v2 no bookmark extensible_dataset
Эта функция позволяет создавать и управлять большими закладками, которые
которые необходимы для других функций ZFS.
.Pp
Эта функция становится
.Sy активной
когда создается закладка v2, и возвращается в состояние
.Sy включена
когда все закладки v2 будут уничтожены.
.
.feature com.delphix bookmark_written no bookmark extensible_dataset bookmark_v2
Эта функция включает дополнительные поля учета закладок, позволяя
.Sy written Ns # Ns Ar bookmark
свойство
.Pq пространство, написанное с момента создания закладки
и оценки размеров потока отправки для инкрементальных записей из закладок.
.Pp
Эта функция становится
.Sy активной
при создании закладки и будет
возвращается во
.Sy включена
когда все закладки с этими полями будут уничтожены.
.
.feature org.openzfs device_rebuild yes
Эта функция включает возможность
.Nm zpool Cm присоединить
и
.Nm zpool Cm заменить
выполнять последовательную реконструкцию
.Pq вместо восстановительной реконструкции
при перепрошивке.
.Pp
Последовательное восстановление перепрошивает устройство в порядке LBA без немедленной
проверки контрольных сумм.
После завершения запускается скраб, который затем проверяет контрольные суммы.
Такой подход позволяет восстановить полную избыточность пула
за минимальное время.
Этот двухфазный подход займет больше времени, чем восстановительный процесс
если учесть время на проверку контрольных сумм.
Однако, если нет дополнительных повреждений пула,
скраб не должен сообщать об ошибках контрольных сумм.
Эта функция несовместима с конфигурациями raidz.
.
Эта функция становится
.Sy активной
во время выполнения последовательного ресайлинга и возвращается в состояние
.Sy включена
после завершения повторной обработки.
.
.feature com.delphix device_removal no
Эта функция включает
.Nm zpool Cm remove
удалять vdev верхнего уровня,
эвакуируя их для уменьшения общего размера пула.
.Pp
Эта функция становится
.Sy активной
после выполнения команды
.Nm zpool Cm remove
команда
на vdev верхнего уровня, и никогда не возвращается в состояние
.Sy выключена.
.
.feature org.openzfs draid no
Эта функция позволяет использовать
.Sy draid
тип vdev.
dRAID - это вариант RAID-Z, обеспечивающий интегрированные распределенные
горячие запасы, которые позволяют ускорить процесс восстановления, сохраняя при этом преимущества RAID-Z.
Данные, контроль четности и резервное пространство организованы в группы избыточности
и равномерно распределяются по всем устройствам.
.Pp
Эта функция становится
.Sy активной
при создании пула, в котором используется
.Sy draid
тип vdev, или при добавлении нового
.Sy draid
vdev в существующий пул.
.
.feature org.illumos edonr no extensible_dataset
Эта функция позволяет использовать хэш-алгоритм Edon-R для контрольной суммы,
в том числе для nopwrite
.Po, если также включено сжатие, перезапись
блока, контрольная сумма которого совпадает с записываемыми данными, будет проигнорирована
.Pc .
В целях предосторожности Edon-R требует проверки при использовании с
dedup:
.Nm zfs Cm set Sy dedup Ns = Ns Sy edonr , Ns Sy verify
.Po см. Xr zfs-set 8 Pc .
.Pp
Edon-R - это очень высокопроизводительный хэш-алгоритм, который был участником
в конкурсе NIST SHA-3.
Он обеспечивает чрезвычайно высокую производительность хэширования
.Pq более чем на 350 % быстрее, чем SHA-256,
но не был выбран из-за своей непригодности
в качестве безопасного хэш-алгоритма общего назначения.
В этой реализации используется новая функциональность контрольного суммирования с использованием соли
в ZFS, что означает, что контрольная сумма предварительно заполняется секретным
256-битным случайным ключом
.Pq, хранящимся в пуле
до того, как ему будет передан блок данных, подлежащий контрольному суммированию.
Таким образом, полученные контрольные суммы уникальны для данного пула,
что предотвращает атаки хэш-коллизий в системах с dedup.
.Pp
.checksum-spiel edonr
.
.feature com.delphix embedded_data no
Эта функция повышает производительность и степень сжатия
сильно сжимаемых блоков.
Блоки, содержимое которых может быть сжато до 112 байт
или меньше, могут использовать эту возможность.
.Pp
Когда эта функция включена, содержимое блоков с высокой степенью сжатия
сохраняется в блоке
.Dq указатель 
сам
.Po в данном случае неверное название, поскольку он содержит
сжатые данные, а не указатель на их расположение на диске.
.Pc .
Таким образом, пространство блока
.Pq одного сектора, обычно 512 B или 4 KiB
сохраняется, и для чтения и записи блока данных не требуется дополнительных операций ввода-вывода.
.
\*[мгновенно - никогда]
.
.feature com.delphix empty_bpobj yes
Эта функция повышает производительность при создании и использовании большого
количества снимков одной файловой системы или тома, а также уменьшает
требуемое дисковое пространство.
.Pp
При большом количестве моментальных снимков каждый снимок использует множество блоков-указателей.
Объекты
.Pq bpobjs
для отслеживания блоков, связанных с этим снимком.
Однако в обычных случаях большинство этих bpobj пустые.
Эта функция позволяет нам создавать каждый bpobj по требованию,
тем самым устраняя пустые bpobj.
.Pp
Эта функция
.Sy активна
пока существуют файловые системы, тома,
или моментальные снимки, которые были созданы после включения этой функции.
.
.feature com.delphix enabled_txg yes
После включения этой функции ZFS записывает номер группы транзакций
в которой были включены новые функции.
Это не оказывает видимого влияния на пользователя, но другие функции могут зависеть от этой функции.
.Pp
Эта функция позволяет
.Sy активен
как только он будет включен, и никогда не вернется в состояние
.Sy включен.
.
.feature com.datto encryption no bookmark_v2 extensible_dataset
Эта функция позволяет создавать и управлять нативными зашифрованными наборами данных.
.Pp
Эта функция становится
.Sy активной
при создании зашифрованного набора данных и возвращается в состояние
.Sy включен
когда все наборы данных, использующие эту функцию, будут уничтожены.
.
.feature com.delphix extensible_dataset no
Эта функция позволяет более гибко использовать внутренние структуры данных ZFS,
и существует для формирования зависимости от других функций.
.Pp
Эта функция будет
.Sy активной
когда первая зависимая функция использует ее, и будет возвращена в состояние
.Sy активированный
когда все наборы данных, использующие эту функцию, будут уничтожены.
.
.feature com.joyent filesystem_limits yes extensible_dataset
Эта функция включает ограничения файловой системы и моментальных снимков.
Эти ограничения можно использовать для управления количеством файловых систем и/или моментальных снимков, которые могут быть созданы в той точке дерева, для которой установлены ограничения.
.Pp
Эта функция
.Sy активна
как только одно из свойств ограничения будет установлено для набора данных
и никогда не будет возвращаться в состояние
.Sy включенной.
.
.feature com.delphix head_errlog no
Эта функция включает обновленную версию errlog, которая требует изменения формата журнала ошибок на диске.
Теперь журнал ошибок каждого набора данных головки хранится отдельно в объекте zap
с ключом по идентификатору головки.
При включении этой функции каждый набор данных, затронутый блоком ошибок, будет перечислен
в выводе
.Nm zpool Cm status .
В случае зашифрованных файловых систем с незагруженными ключами мы не можем проверить
их моментальные снимки или клоны на наличие ошибок, и они не будут переданы.
Будет выдана ошибка "доступ запрещен".
.Pp
\*[мгновенно-никогда]
.
.feature com.delphix hole_birth no enabled_txg
У этой функции есть/были ошибки, в результате которых, если вы выполняете
.Nm zfs Cm отправить Fl i
.Pq или Fl R , No, поскольку он использует Fl i
из затронутого набора данных, получающая сторона не увидит никаких контрольных сумм
или других ошибок, но полученный снимок получателя
не будет соответствовать исходному.
Его использование
.Nm zfs Cm отправить Fl i
было отключено по умолчанию
.Po
см.
.Sy send_holes_without_birth_time
в
.Xr zfs 4
.Pc .
.Pp
Эта функция улучшает производительность инкрементных отправок
.Pq Nm zfs Cm send Fl i
и приема для объектов с большим количеством дыр.
Наиболее распространенным случаем объектов с дырами является zvols.
.Pp
Инкрементный поток отправки из моментального снимка
.Sy A No к снапшоту Sy B
содержит информацию о каждом блоке, который изменился между
.Sy A No и Sy B .
Блоки, которые не изменились между этими моментальными снимками, можно идентифицировать и исключить из потока с помощью части метаданных, называемой
.
.Dq время рождения блока  ,
но время рождения не записывается для
.Pq блоков с дырами, заполненных только нулями..
Поскольку дыры, созданные после
.Sy A No невозможно отличить от дыр, созданных до Sy A ,
информация о каждой дыре во всей файловой системе или zvol
включается в поток отправки.
.Pp
Для рабочих нагрузок, где дыры встречаются редко, это не является проблемой.
Однако при инкрементной репликации файловых систем или zvol с большим количеством дыр
.Pq например, zvol, отформатированный под другую файловую систему
много времени будет потрачено на отправку и получение ненужной информации
о дырах, которые уже существуют на принимающей стороне.
.Pp
После того, как в файловой системе
.Sy hole_birth
будет включено время рождения блока
для всех новых дыр.
Инкрементные отправки между снимками, созданные после включения этой функции
будут использовать эти новые метаданные, чтобы избежать отправки информации о дырах, которые уже существуют на принимающей стороне.
.Pp
\*[мгновенно - никогда]
.
.feature org.open-zfs large_blocks no extensible_dataset
Эта функция позволяет установить размер записи в наборе данных больше 128 килобайт.
.Pp
Эта функция становится
.Sy активной
если набор данных содержит файл с размером блока более 128 килобайт,
и возвращается в состояние
.Sy включена
когда все файловые системы, размер блока которых когда-либо превышал 128 килобайт, будут уничтожены.
.
.feature org.zfsonlinux large_dnode no extensible_dataset
Эта функция позволяет устанавливать размер dnode в наборе данных больше 512 B.
.
Эта функция становится
.Sy активной
если набор данных содержит объект с dnode больше 512 B,
что происходит в результате установки параметра
.Sy dnodesize
свойства набора данных в значение, отличное от
.Sy legacy .
Функция вернется в состояние
.Sy включенной
как только все файловые системы, в которых когда-либо содержался dnode размером более 512 B
будут уничтожены.
Большие dnode позволяют хранить больше данных в резервном буфере,
таким образом, потенциально можно повысить производительность, избежав использования блоков-переливов.
.
.feature com.delphix livelist yes
Эта функция позволяет удалять клоны быстрее, чем обычный метод
когда в клоне было сделано большое количество случайных/разрозненных записей.
Все блоки, выделенные и освобожденные после создания клона, отслеживаются в
живом списке клона, на который ссылаются при удалении клона.
Функция активируется при создании клона и остается
активной
пока все клоны не будут уничтожены.
.
.feature com.delphix log_spacemap yes com.delphix:spacemap_v2
Эта функция повышает производительность сильно фрагментированных пулов,
особенно при больших нагрузках, связанных со случайными записями.
Для этого она регистрирует все изменения метасборки на одной spacemap каждый TXG
вместо многократной записи на все пространственные карты метасреды.
.Pp
\*[мгновенно - никогда]
.
.feature org.illumos lz4_compress no
.Sy lz4
это высокопроизводительный алгоритм сжатия в реальном времени, который
отличается значительно более быстрой компрессией и декомпрессией, а также
более высокой степенью сжатия, чем старый
.Sy lzjb
сжатия.
Как правило,
.Sy lz4
сжимается примерно на 50 % быстрее для сжимаемых данных и на 200 % быстрее
на несжимаемых данных, чем
.Sy lzjb .
Он также примерно на 80 % быстрее при декомпрессии,
при этом коэффициент сжатия примерно на 10% выше.
.Pp
Когда
.Sy lz4_compress
функция установлена на
.Sy включена ,
администратор может включить
.Sy lz4
сжатие для любого набора данных в пуле 
.Xr zfs-set 8
команда.
Все вновь записанные метаданные будут сжаты с помощью команды
.Sy lz4
алгоритмом.
.Pp
\*[мгновенно - никогда]
.
.feature com.joyent multi_vdev_crash_dump no
Эта функция позволяет сконфигурировать устройство дампа с пулом, состоящим
из нескольких vdev.
Эти vdev могут быть расположены в любой зеркальной или raidz-конфигурации.
.Pp
Когда
.Sy multi_vdev_crash_dump
функция установлена в значение
.Sy enabled ,
администратор может использовать
.Xr dumpadm 8
для настройки устройства дампа на пуле, состоящем из нескольких vdev.
.Pp
По адресу
.Fx
и Linux эта функция не используется, но зарегистрирована для совместимости.
Новые пулы, созданные в этих системах, будут иметь функцию
.Sy включена
но никогда не перейдет в режим
.Sy активна,
поскольку эта функция не требуется для поддержки аварийного дампа.
Существующие пулы, в которых эта функция
.Sy активна
могут быть импортированы.
.
.feature com.delphix obsolete_counts yes device_removal
Эта функция является усовершенствованием функции
.Sy device_removal ,
которая со временем уменьшит объем памяти, используемой для отслеживания удаленных устройств.
Когда косвенные блоки освобождаются или перераспределяются,
мы отмечаем, что их часть косвенного отображения
.Dq устарела
- больше не нужна.
.Pp
Эта функция становится
.Sy активной
когда
.Nm zpool Cm remove
на vdev верхнего уровня, и никогда не возвращается в состояние
.Sy включена.
.
.feature org.zfsonlinux project_quota yes extensible_dataset
Эта функция позволяет администраторам учитывать информацию об использовании пространств и объектов
в соответствии с идентификатором проекта
.Pq ID .
.Pp
Идентификатор проекта - это атрибут, основанный на объекте.
При обновлении существующей файловой системы,
объектам, не имеющим идентификатора проекта, будет присвоен нулевой идентификатор проекта.
Когда эта функция включена, вновь созданные объекты наследуют
ID проекта своих родительских каталогов, если установлен флаг наследования родительского каталога.
.Pq через Nm chattr Sy [+-]P No или Nm zfs Cm project Fl s Ns | Ns Fl C .
В противном случае идентификатор проекта нового объекта будет равен нулю.
Идентификатор проекта объекта может быть изменен в любое время владельцем
.Pq или привилегированный пользователь
через
.Nm chattr Fl p Ar prjid
или
.Nm zfs Cm project Fl p Ar prjid .
.Pp
Эта функция станет
.Sy активной
как только она будет включена, и никогда не вернется в состояние
.Sy отключенной.
\*[перемонтировать-обновить]
.
.feature com.delphix redaction_bookmarks no bookmarks extensible_dataset
Эта функция позволяет использовать отредактированные
.Nm zfs Cm send Ns s ,
которые создают закладки редактирования, хранящие список блоков, 
отредактированных создателем.
Дополнительные сведения о отредактированных отправках см. в разделе
.Xr zfs-send 8 .
.
.feature com.delphix redacted_datasets no extensible_dataset
Эта функция позволяет получать отредактированные
.Nm zfs Cm send
потоки, которые при получении создают отредактированные наборы данных.
В этих наборах данных отсутствуют некоторые блоки,
и поэтому их нельзя безопасно смонтировать, а их содержимое нельзя безопасно прочитать.
Дополнительные сведения о получении отредактированных данных см.
.Xr zfs-send 8 .
.
.feature com.datto resilver_defer yes
Эта функция позволяет ZFS откладывать новые ресильверы, если существующий уже
в процессе.

Без этой функции любой новый ресилвер будет приводить к тому, что текущий
будет немедленно перезапущен с самого начала.
.Pp
Эта функция становится
.Sy активной
как только ресильвер был отложен, и возвращается в состояние
.Sy включен
когда начинается отложенный ресайклинг.
.
.feature org.illumos sha512 no extensible_dataset
Эта функция позволяет использовать алгоритм усеченного хэша SHA-512/256.
.Pq FIPS 180-4
для контрольных сумм и дедупликации.
Встроенная 64-разрядная арифметика SHA-512 обеспечивает
повышение производительности примерно на 50% по сравнению с SHA-256 на 64-разрядном оборудовании
и, таким образом, является хорошим кандидатом на замену с минимальными изменениями
для систем, где важна производительность хэширования,
но эти системы по какой-либо причине не могут использовать более быстрые
.Sy skein No и Sy edonr
алгоритмы.
.Pp
.checksum-spiel sha512
.
.feature org.illumos skein no extensible_dataset
Эта функция позволяет использовать хэш-алгоритм Skein для контрольной суммы и вычитания.
Skein - это высокопроизводительный безопасный хэш-алгоритм, который был
финалистом конкурса NIST SHA-3.
Он обеспечивает очень высокий уровень безопасности и высокую производительность на 64-битном оборудовании
.Pq на 80 % быстрее, чем SHA-256.
В этой реализации также используется новая функция соленого контрольного суммирования
в ZFS, что означает, что контрольная сумма предварительно заполняется
секретным 256-битным случайным ключом
.Pq, хранящимся в пуле
перед тем, как ему будет передан блок данных, подлежащий контрольному суммированию.
Таким образом, полученные контрольные суммы уникальны для данного пула,
что предотвращает атаки хэш-коллизий в системах с dedup.
.Pp
.checksum-spiel skein
.
.feature com.delphix spacemap_histogram yes
Эта функция позволяет ZFS хранить больше информации о том, как свободное пространство
организовано в пуле.
Если эта функция
.Sy включена ,
она будет активирована при создании нового объекта карты пространства или
когда существующая карта пространства обновляется до нового формата,
и больше никогда не возвращается в состояние
.Sy включена.
.
.feature com.delphix spacemap_v2 yes
Эта функция позволяет использовать новую кодировку карты пространства, которая
состоит из двух слов
.Pq вместо одного
во всех случаях, когда это выгодно.
Новая кодировка позволяет картам пространства представлять большие области
пространства на диске более эффективно, увеличивая при этом их максимальное
адресуемое смещение.
.Pp
Эта функция становится
.Sy активной
как только она
.Sy включена,
и никогда не возвращается обратно в состояние
.Sy включена.
.
.feature org.zfsonlinux userobj_accounting yes extensible_dataset
Эта функция позволяет администраторам учитывать информацию об использовании объектов
по пользователям и группам.
.Pp
\*[мгновенно - никогда]
\*[перемонтирование-обновление]
.
.feature com.klarasystems vdev_zaps_v2 no
Эта функция создает объект ZAP для корневого vdev.
.Pp
Эта функция становится активной после следующего
.Nm zpool Cm import
или
.Nm zpool reguid .
.
Свойства могут быть получены или установлены на корневом vdev с помощью
.Nm zpool Cm get
и
.Nm zpool Cm set
с помощью
.Sy root
в качестве имени vdev, которое является псевдонимом для
.Sy root-0 .
.feature org.openzfs zilsaxattr yes extensible_dataset
Эта функция позволяет
.Sy xattr Ns = Ns Sy sa
расширенную регистрацию атрибутов в ZIL.
Если этот параметр включен, расширенный атрибут изменяется
.Pq и Sy xattrdir Ns = Ns Sy dir No, и Sy xattr Ns = Ns Sy sa
являются долговечными, если в наборе данных либо
.Sy sync Ns = Ns Sy always
установлен на момент внесения изменений, либо
.Xr sync 2
вызывается на наборе данных после внесения изменений.
.Pp
Эта функция становится
.Sy активной
когда создается ZIL хотя бы для одного набора данных, и возвращается в состояние
.Sy включен
когда он будет уничтожен для всех наборов данных, использующих эту функцию.
.
.feature com.delphix zpool_checkpoint yes
Эта функция включает
.Nm zpool Cm checkpoint
которая может проверить состояние пула
на момент ее выполнения и впоследствии вернуться к ней или отбросить ее.
.Pp
Эта функция становится
.Sy активной
когда
.Nm zpool Cm checkpoint
используется для создания контрольной точки пула.
Функция вернется в состояние
.Sy включена
только после перемотки пула или отмены контрольной точки.
.
.feature org.freebsd zstd_compress no extensible_dataset
.Sy zstd
это высокопроизводительный алгоритм сжатия, который отличается
сочетанием высокой степени сжатия и высокой скорости.
По сравнению с
.Sy gzip ,
.Sy zstd
обеспечивает немного лучшее сжатие при гораздо более высокой скорости.
По сравнению с
.Sy lz4 ,
.Sy zstd
обеспечивает гораздо лучшее сжатие при незначительной скорости.
Как правило,
.Sy zstd
скорость сжатия составляет от 250 до 500 МБ/с на поток,
а скорость декомпрессии превышает 1 ГБ/с на поток.
.Pp
Когда
.Sy zstd
функция установлена в положение
.Sy enabled ,
администратор может включить
.Sy zstd
сжатие любого набора данных с помощью
.Nm zfs Cm set Sy compress Ns = Ns Sy zstd Ar dset
.Po см. Xr zfs-set 8 Pc .
Эта функция становится
.Sy активной
как только
.Sy compress
было установлено свойство
.Sy zstd ,
и вернется в состояние
.Sy включен 
как только все файловые системы, у которых когда-либо было 
.Sy compress
установлено свойство
.Sy zstd
будут уничтожены.
.El
.
.Sh
.Xr zfs 8 ,
.Xr zpool 8
